<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Language Hub</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #f0f2f5;
      color: #1c1e21;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh; 
    }
    .container {
      width: 100%;
      max-width: 1400px;
      background: #fff;
      padding: 25px 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      min-height: calc(100vh - 40px); 
    }
    h1, h2 { text-align: center; color: #333; }
    .hide { display: none !important; }

    /* --- MENU --- */
    #main-menu { text-align: center; }
    #main-menu .menu-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
      flex-wrap: wrap;
    }
    .menu-button {
      font-size: 1.2em;
      padding: 20px 40px;
      border-radius: 10px;
      border: none;
      color: white;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .menu-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0,0,0,0.15);
    }
    #reading-btn { background-color: #2980b9; }
    #listening-btn { background-color: #27ae60; }
    #vocab-btn { background-color: #8e44ad; }
    #sentence-btn { background-color: #f39c12; }

    /* --- BUTTON STYLE --- */
    button {
      border: none;
      border-radius: 8px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      padding: 12px 20px;
      transition: background-color 0.2s ease, transform 0.1s ease;
    }
    button:hover { transform: translateY(-2px); }
    .btn-primary { background-color: #2980b9; color: #fff; }
    .btn-primary:hover { background-color: #3498db; }
    .btn-secondary {
      background-color: #6c757d;
      color: white;
    }
    .btn-secondary:hover {
      background-color: #5a6268;
    }

    /* --- COMMON SECTION STYLES --- */
    .practice-controls {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
      align-items: flex-end;
      flex-wrap: wrap; 
    }
    .practice-control-group {
      flex-grow: 1;
      min-width: 200px; 
      display: flex;
      flex-direction: column;
    }
    label { font-weight: 600; margin-bottom: 8px; color: #606770; }
    select {
      font-size: 16px;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #dddfe2;
      background-color: #f5f6f7;
    }
    select:disabled {
        background-color: #e9ecef;
        cursor: not-allowed;
    }
    
    /* --- PRACTICE SECTION --- */
    #question-display {
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      padding: 20px;
      min-height: 400px;
      background-color: #fafafa;
    }
    #question-display iframe {
      width: 100%;
      height: 500px;
      border-radius: 8px;
      border: none;
    }

    /* --- VOCAB & SENTENCE LAYOUT --- */
    .vocab-main-wrapper, .sentence-main-wrapper { 
        display: flex; 
        gap: 30px; 
        margin-top: 20px; 
    }
    .vocab-test-panel, .sentence-game-panel { 
        flex-grow: 1; 
    }
    .vocab-controls-panel, .sentence-controls-panel {
      flex: 0 0 250px; 
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .vocab-control-group, .sentence-control-group {
      background-color: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    #vocab-setup-controls, #sentence-setup-controls {
      display: grid;
      grid-template-columns: auto minmax(0, 1fr);
      gap: 15px;
      align-items: center;
    }
    
    #vocab-setup-controls select, #sentence-setup-controls select {
        max-width: 100%; 
        box-sizing: border-box;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    #vocab-setup-controls label, #sentence-setup-controls label {
        margin-bottom: 0;
        text-align: right;
        white-space: normal;
        line-height: 1.2;
    }
    
    #vocab-setup-controls button, #sentence-setup-controls button {
        grid-column: 1 / -1;
        white-space: nowrap; 
        width: 100%;
    }

    #vocab-test-controls {
        flex-direction: row; 
        flex-wrap: wrap;
        padding: 15px; 
    }

    #vocab-test-controls button {
        flex: 1 1 45%; 
        min-width: 100px;
        margin: 5px; 
        white-space: nowrap;
    }

    .vocab-controls-panel > .back-btn, .sentence-controls-panel > .back-btn {
        width: 100%; 
        box-sizing: border-box;
    }
    
    #vocab-test-container {
      width: 100%;
    }
    #vocab-test-container table {
      width: 100%;
      border-collapse: collapse;
      font-size: 1.4em;
      table-layout: fixed; 
    }
    #vocab-test-container th, #vocab-test-container td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }
    #vocab-test-container th:first-child,
    #vocab-test-container td.num-cell {
      width: 60px;
      text-align: center;
    }
    #vocab-test-container th:nth-child(2),
    #vocab-test-container td:nth-child(2),
    #vocab-test-container th:nth-child(3),
    #vocab-test-container td:nth-child(3) {
      width: 47%; 
    }

    .answer-cell span { visibility: hidden; color: #27ae60; font-weight: bold; }
    .answer-cell span.visible { visibility: visible; }
    
    #vocab-print-copy-area { display: none; }

    /* --- SENTENCE SECTION --- */
    #sentence-display {
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        padding: 30px;
        min-height: 200px;
        background-color: #fafafa;
        text-align: center;
        font-size: 1.5em;
        line-height: 1.6;
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: 20px;
    }
    #sentence-question {
        color: #2c3e50;
        font-weight: 500;
    }
    #sentence-answer {
        color: #27ae60;
        font-weight: bold;
    }

    /* --- PRINT STYLES --- */
    @media print {
        @page { size: A4 landscape; margin: 1cm; }
        
        body, .container {
            padding: 0; margin: 0; 
            background: none !important; 
            display: block !important; 
            width: 100% !important;
            box-shadow: none !important;
            height: auto !important; 
            min-height: auto !important; 
            overflow: hidden !important; 
        }

        .container > :not(#vocab-section),
        #vocab-section > :not(.vocab-main-wrapper),
        .vocab-main-wrapper > :not(.vocab-test-panel) {
            display: none !important;
        }

        #vocab-section, .vocab-main-wrapper {
            display: block !important; 
            width: 100%; margin: 0; padding: 0;
            height: auto !important; min-height: auto !important;
        }
        
        .vocab-test-panel {
            display: flex !important; 
            justify-content: space-between;
            gap: 20px;
            width: 100%;
            height: 98vh; 
            padding: 0;
            box-shadow: none;
            background: none;
        }

        #vocab-test-container, 
        #vocab-print-copy-area {
            display: flex !important; 
            flex-direction: column;
            width: 49%; 
            height: 100%;
            page-break-inside: avoid; 
            box-sizing: border-box;
            margin: 0;
        }
        
        #vocab-test-container table,
        #vocab-print-copy-area table {
            width: 100%; 
            height: 100%;
            border-collapse: collapse;
            font-size: 11pt; 
            table-layout: fixed;
            display: table;
        }
        
        #vocab-test-container th, #vocab-test-container td,
        #vocab-print-copy-area th, #vocab-print-copy-area td { 
            border: 1px solid #000; 
            padding: 4px 6px; 
            vertical-align: top;
        }

        #vocab-test-container th:first-child,
        #vocab-print-copy-area th:first-child {
            width: 40px; 
        }
        
        .answer-cell span { 
            visibility: hidden !important; 
        }
    }
  </style>
</head>
<body>
<div class="container">
  <div id="main-menu">
    <h1>Language Practice Hub</h1>
    <p>Please choose an activity</p>
    <div class="menu-buttons">
      <button id="reading-btn" class="menu-button">Reading Practice</button>
      <button id="listening-btn" class="menu-button">Listening Practice</button>
      <button id="vocab-btn" class="menu-button">Vocabulary Test</button>
      <button id="sentence-btn" class="menu-button">Sentence Games</button>
    </div>
  </div>

  <div id="practice-section" class="hide">
    <h1 id="practice-title">Practice Section</h1>
    <input type="hidden" id="current-practice-type" value="">
    <div class="practice-controls">
      <div class="practice-control-group">
        <label for="topic-select">Choose a Theme:</label>
        <select id="topic-select"><option>Loading Themes...</option></select>
      </div>
      <div class="practice-control-group">
        <label for="question-select">Choose a Question:</label>
        <select id="question-select"><option>Select a Theme first...</option></select>
      </div>
      <button id="generate-practice-btn" class="btn-primary">Load Question</button>
      <button id="fullscreen-btn" class="btn-primary hide">üîà Open Full Screen</button>
      <button class="btn-primary back-btn">Back to Main Menu</button>
    </div>
    <div id="question-display">
      <h2>Your question will appear here</h2>
      <p>Select a theme and question, then click "Load Question".</p>
    </div>
  </div>

  <div id="vocab-section" class="hide">
    <div class="vocab-main-wrapper">
      <div class="vocab-test-panel">
        <div id="vocab-test-container" class="hide">
          <table>
            <thead><tr><th>No.</th><th>Target Language</th><th>English</th></tr></thead>
            <tbody id="vocab-test-body"></tbody>
          </table>
        </div>
        <div id="vocab-print-copy-area"></div> 
      </div>
      <div class="vocab-controls-panel" id="vocab-controls-panel">
        <h1>Vocabulary Test</h1>
        <p id="vocab-loading-message" class="hide">Loading...</p>
        <div id="vocab-setup-controls" class="vocab-control-group">
          <label for="class-select">Class:</label><select id="class-select"></select>
          <label for="vocab-theme-select">Theme:</label><select id="vocab-theme-select"></select>
          <label for="vocab-set-select">Set:</label><select id="vocab-set-select"></select>
          <label for="vocab-set-select-2">2nd set:</label><select id="vocab-set-select-2"></select>
          <button id="vocab-generate-btn" class="btn-primary">Generate List</button>
        </div>
        <div id="vocab-test-controls" class="vocab-control-group hide">
          <button id="vocab-reveal-btn" class="btn-primary">Reveal Answers</button>
          <button id="vocab-print-btn" class="btn-primary">üñ®Ô∏è Print Test</button>
        </div>
        <button class="btn-primary back-btn">Back to Main Menu</button>
      </div>
    </div>
  </div>

  <div id="sentence-section" class="hide">
      <div class="sentence-main-wrapper">
          <div class="sentence-game-panel">
              <div id="sentence-display">
                  <h2>Your sentence game will appear here.</h2>
                  <p>Select a theme, topic, and game, then click "Start Game".</p>
              </div>
          </div>
          <div class="sentence-controls-panel">
              <h1>Sentence Games</h1>
              <div id="sentence-setup-controls" class="sentence-control-group">
                  <label for="sentence-theme-select">Theme:</label>
                  <select id="sentence-theme-select"></select>
                  <label for="sentence-topic-select">Topic:</label>
                  <select id="sentence-topic-select"></select>
                  <label for="game-select">Game:</label>
                  <select id="game-select"></select>
                  <button id="start-game-btn" class="btn-primary">Start Game</button>
              </div>
              <button class="btn-primary back-btn">Back to Main Menu</button>
          </div>
      </div>
  </div>
</div>

<script>
// --- URLs and Global Variables ---
const practiceSheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRvNFlHDx-4cZbDzwKy5Yb_DKeSxS2wSXxyX1Ua6pGcf27yFjmqOPz9jQ_rzoV3-zoZI9lw4EIfmdXH/pub?output=csv";
const sentenceSheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTeenmRJ1Gqolo-8KqU5A84PProbYHoY3SrXKFxFgdzwf_FdmJnpfbpEf9KmbhqhQk17K6USG_UOJg9/pub?output=csv";

const vocabSpreadsheetUrls = {
    'GCSE French': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSCNeq329ih6SxLZ2TowPzpk61gJLFy-UAVAb8ivBs9DNEOdmtRQ29bWh__n53MdE-C8hs_XOV3iIkT/pub?output=csv',
    'GCSE German': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTlddh1-sO5-s5CPJt_a1H1ltX9orRCFvosUPVBJIqjxXc0nB3c4-f19sUNF5s6lIof7TnBIevleWJA/pub?output=csv',
    'Y9 German': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS2uwRf4d6BaS3Pr8s5Kh6l5qcueQdIypB4rB_gQVO1WNNC21wfcAALqUVflppBR5TaCFgBLFI8yCpF/pub?output=csv',
    'Y9 French': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRnDLxwYIiKui39_UjS66eQtrFttct-nEpnEcD06p15Bm9iNpxdFihDfj6BxggMLLukIyJ72SeF_EEM/pub?output=csv',
    'AS French': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRrT8UxOP9RIX0Udy7Q12-D2HJJVp8jfpd8lnbGO9vlHsXnWgtVeJlTXarZlROdR7cvc-Wug2ukblC8/pub?output=csv',
    'A2 French': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRbdjmR3pBk7FniGAuKvlKQk_1zfuY9XlyhQtim-ABIdxEWk-8WmcUHxcDwOui7d1R0Uvk66LTr6eON/pub?output=csv'
};

let practice_allQuestions = [];
let vocab_vocabSets = {};
let sentenceSets = {};
let currentGameSettings = {}; // Stores current game for 'Next' button

// --- DOM Element References ---
const mainMenu = document.getElementById('main-menu');
const practiceSection = document.getElementById('practice-section');
const vocabSection = document.getElementById('vocab-section');
const sentenceSection = document.getElementById('sentence-section');
const readingBtn = document.getElementById('reading-btn');
const listeningBtn = document.getElementById('listening-btn');
const vocabBtn = document.getElementById('vocab-btn');
const sentenceBtn = document.getElementById('sentence-btn');
const currentPracticeTypeInput = document.getElementById('current-practice-type');
const practice_topicSelect = document.getElementById('topic-select'); 
const practice_questionSelect = document.getElementById('question-select'); 
const practice_generateBtn = document.getElementById('generate-practice-btn');
const practice_questionDisplay = document.getElementById('question-display');
const fullscreenBtn = document.getElementById('fullscreen-btn');
const classSelect = document.getElementById('class-select');
const vocabLoadingMessage = document.getElementById('vocab-loading-message');
const vocab_themeSelect = document.getElementById('vocab-theme-select');
const vocab_setSelect = document.getElementById('vocab-set-select');
const vocab_setSelect2 = document.getElementById('vocab-set-select-2');
const vocab_generateBtn = document.getElementById('vocab-generate-btn');
const vocab_testContainer = document.getElementById('vocab-test-container');
const vocab_testBody = document.getElementById('vocab-test-body');
const vocab_printCopyArea = document.getElementById('vocab-print-copy-area');
const vocab_testControls = document.getElementById('vocab-test-controls');
const vocab_revealBtn = document.getElementById('vocab-reveal-btn');
const sentenceThemeSelect = document.getElementById('sentence-theme-select');
const sentenceTopicSelect = document.getElementById('sentence-topic-select');
const gameSelect = document.getElementById('game-select');
const startGameBtn = document.getElementById('start-game-btn');
const sentenceDisplay = document.getElementById('sentence-display');

// --- Navigation ---
readingBtn.addEventListener('click', () => { stopMedia(); showPractice('Reading'); });
listeningBtn.addEventListener('click', () => { stopMedia(); showPractice('Listening'); });
vocabBtn.addEventListener('click', () => { stopMedia(); showVocabTest(); });
sentenceBtn.addEventListener('click', () => { stopMedia(); showSentenceGames(); });
document.querySelectorAll('.back-btn').forEach(btn => btn.addEventListener('click', showMainMenu));

function stopMedia() {
    practice_questionDisplay.innerHTML = `<h2>Your question will appear here</h2><p>Select a theme and question, then click "Load Question".</p>`;
    fullscreenBtn.classList.add('hide');
    fullscreenBtn.onclick = null;
}

function showMainMenu() {
    stopMedia(); 
    mainMenu.classList.remove('hide');
    practiceSection.classList.add('hide');
    vocabSection.classList.add('hide');
    sentenceSection.classList.add('hide');
    
    vocab_testContainer.classList.add('hide');
    vocab_testBody.innerHTML = ''; 
    vocab_testControls.classList.add('hide');
    vocab_revealBtn.textContent = 'Reveal Answers'; 
    classSelect.value = ''; 
    resetVocabDropdowns(true);
}

function showPractice(type) {
    mainMenu.classList.add('hide');
    practiceSection.classList.add('hide');
    vocabSection.classList.add('hide');
    sentenceSection.classList.add('hide');
    document.getElementById('practice-title').textContent = `${type} Practice`;
    currentPracticeTypeInput.value = type;
    practice_populateTopics();
}

function showVocabTest() {
    mainMenu.classList.add('hide');
    practiceSection.classList.add('hide');
    vocabSection.classList.remove('hide');
    sentenceSection.classList.add('hide');
}

function showSentenceGames() {
    mainMenu.classList.add('hide');
    practiceSection.classList.add('hide');
    vocabSection.classList.add('hide');
    sentenceSection.classList.remove('hide');
}

// --- Data Loading ---
function loadData(url, options) {
    return new Promise((resolve, reject) => {
        Papa.parse(url, {
            ...options, download: true, skipEmptyLines: true,
            complete: (results) => resolve(results.data),
            error: (err) => reject(err),
        });
    });
}

async function initializeApp() {
    [readingBtn, listeningBtn, vocabBtn, sentenceBtn].forEach(btn => btn.disabled = true);
    readingBtn.textContent = 'Loading...';

    populateClassSelector();
    resetVocabDropdowns(true);
    populateGameSelector();

    try {
        const [practiceData, sentenceData] = await Promise.all([
            loadData(practiceSheetUrl, { header: true }),
            loadData(sentenceSheetUrl, { header: false })
        ]);

        practice_allQuestions = practiceData.map(q => ({
            Skill: q.Skill, Theme: q.Theme, Question: q.Question, Content: q.Content
        })).filter(q => q.Skill && q.Theme && q.Content);

        sentenceSets = {};
        let currentSentenceTheme = null, currentSentenceTopic = null;
        sentenceData.forEach(row => {
            if (!row || row.length < 5) return;
            const [themeInRow, topicInRow, , target, english] = row.map(cell => cell?.trim());
            if (themeInRow) currentSentenceTheme = themeInRow;
            if (currentSentenceTheme && topicInRow) currentSentenceTopic = topicInRow;
            if (currentSentenceTheme && currentSentenceTopic && target && english) {
                if (!sentenceSets[currentSentenceTheme]) sentenceSets[currentSentenceTheme] = {};
                if (!sentenceSets[currentSentenceTheme][currentSentenceTopic]) sentenceSets[currentSentenceTheme][currentSentenceTopic] = [];
                sentenceSets[currentSentenceTheme][currentSentenceTopic].push({ target, english });
            }
        });
        sentence_initializeSelectors();

        [readingBtn, listeningBtn, vocabBtn, sentenceBtn].forEach(btn => btn.disabled = false);
        readingBtn.textContent = 'Reading Practice';

    } catch (error) {
        console.error("Failed to load initial spreadsheet data:", error);
    }
}

// --- Practice Section Logic ---
practice_topicSelect.addEventListener('change', () => { stopMedia(); practice_populateQuestions(); });
practice_generateBtn.addEventListener('click', practice_generateQuestion);
// ... (practice section functions remain unchanged but are included for completeness)
function practice_populateTopics() { /* ... */ }
function practice_populateQuestions() { /* ... */ }
function practice_generateQuestion() { /* ... */ }


// --- Vocabulary Section Logic ---
classSelect.addEventListener('change', () => {
    const selectedClass = classSelect.value;
    vocab_testContainer.classList.add('hide'); 
    vocab_testControls.classList.add('hide');
    if (selectedClass && vocabSpreadsheetUrls[selectedClass]) {
        loadVocabData(vocabSpreadsheetUrls[selectedClass]);
    } else {
        resetVocabDropdowns(true);
    }
});
// ... (rest of vocab functions are included for completeness)
function resetVocabDropdowns(disabled) { /* ... */ }
function vocab_initializeSelectors() { /* ... */ }
function vocab_updateSetDropdown() { /* ... */ }
function createVocabTableRows(shuffledWords) { /* ... */ }
function vocab_generateTest() { /* ... */ }
function vocab_revealAnswers() { /* ... */ }
function vocab_generatePrintVersion() { /* ... */ }


// --- SENTENCE GAME LOGIC ---
function populateGameSelector() {
    const games = {
        'unjumble': 'Unjumble', 'no-spaces': 'No Spaces', 'no-vowels': 'No Vowels',
        'no-consonants': 'No Consonants', 'random-target': 'Random Target', 'random-en': 'Random EN'
    };
    gameSelect.innerHTML = '<option value="">-- Select a Game --</option>';
    for (const [value, text] of Object.entries(games)) {
        gameSelect.add(new Option(text, value));
    }
}

function sentence_initializeSelectors() {
    const themes = Object.keys(sentenceSets);
    sentenceThemeSelect.innerHTML = '<option value="">-- Select Theme --</option>';
    if (themes.length === 0) {
        sentenceThemeSelect.innerHTML = '<option>No Themes</option>';
        return;
    }
    themes.sort().forEach(theme => sentenceThemeSelect.add(new Option(theme, theme)));
    sentence_updateTopicDropdown();
}

function sentence_updateTopicDropdown() {
    const theme = sentenceThemeSelect.value;
    sentenceTopicSelect.innerHTML = '<option value="">-- Select Topic --</option>';
    if (!theme || !sentenceSets[theme]) return;
    const topics = Object.keys(sentenceSets[theme]);
    topics.sort().forEach(topic => {
        const text = `${topic} (${sentenceSets[theme][topic].length} sentences)`;
        sentenceTopicSelect.add(new Option(text, topic));
    });
}

sentenceThemeSelect.addEventListener('change', sentence_updateTopicDropdown);
startGameBtn.addEventListener('click', () => {
    currentGameSettings.theme = sentenceThemeSelect.value;
    currentGameSettings.topic = sentenceTopicSelect.value;
    currentGameSettings.gameType = gameSelect.value;
    playSentenceGame();
});

function playSentenceGame() {
    const { theme, topic, gameType } = currentGameSettings;
    if (!theme || !topic || !gameType) {
        alert('Please select a Theme, Topic, and Game first.');
        return;
    }
    const sentences = sentenceSets[theme][topic];
    const sentencePair = sentences[Math.floor(Math.random() * sentences.length)];
    let question = '', answer = `${sentencePair.target}<br><br><em>(${sentencePair.english})</em>`;

    switch (gameType) {
        case 'unjumble': question = sentencePair.target.split(' ').sort(() => 0.5 - Math.random()).join(' '); break;
        case 'no-spaces': question = sentencePair.target.replace(/\s/g, ''); break;
        case 'no-vowels': question = sentencePair.target.replace(/[aeiouAEIOU]/g, '_'); break;
        case 'no-consonants': question = sentencePair.target.replace(/[^aeiouAEIOU\s\W\d]/g, '_'); break;
        case 'random-target':
            question = 'Translate this into the target language:';
            answer = `${sentencePair.english}<br><br><em>(${sentencePair.target})</em>`;
            break;
        case 'random-en':
            question = 'Translate this into English:';
            answer = `${sentencePair.target}<br><br><em>(${sentencePair.english})</em>`;
            break;
    }

    sentenceDisplay.innerHTML = `
        <div id="sentence-question">${question}</div>
        <div id="sentence-answer" class="hide">${answer}</div>
        <div id="sentence-button-area">
            <button id="reveal-sentence-btn" class="btn-secondary">Reveal Answer</button>
        </div>
    `;

    document.getElementById('reveal-sentence-btn').addEventListener('click', () => {
        document.getElementById('sentence-answer').classList.remove('hide');
        const buttonArea = document.getElementById('sentence-button-area');
        buttonArea.innerHTML = `<button id="next-sentence-btn" class="btn-primary">Next Sentence</button>`;
        document.getElementById('next-sentence-btn').addEventListener('click', playSentenceGame);
    }, { once: true });
}

// --- Placeholder Full Functions ---
// (These are copy-pasted from your last version to keep the file complete)
function practice_populateTopics(){const selectedType=currentPracticeTypeInput.value;const themes=[...new Set(practice_allQuestions.filter(q=>q.Skill&&q.Skill.trim()===selectedType).map(q=>q.Theme))];practice_topicSelect.innerHTML='<option value="">-- Select Theme --</option>';if(themes.length===0){practice_topicSelect.innerHTML=`<option>No Themes Available</option>`;practice_questionSelect.innerHTML=`<option>Select a Theme first...</option>`;return}themes.sort().forEach(theme=>{if(theme){const opt=document.createElement('option');opt.value=theme;opt.textContent=theme;practice_topicSelect.appendChild(opt)}});practice_populateQuestions()}
function practice_populateQuestions(){const selectedTheme=practice_topicSelect.value;const selectedType=currentPracticeTypeInput.value;practice_questionSelect.innerHTML='';if(!selectedTheme){practice_questionSelect.innerHTML=`<option>Select a Theme first...</option>`;return}const questions=practice_allQuestions.filter(q=>q.Skill&&q.Skill.trim()===selectedType&&q.Theme===selectedTheme);if(questions.length===0){practice_questionSelect.innerHTML=`<option>No Questions Available</option>`;return}questions.forEach((q,index)=>{const opt=document.createElement('option');opt.value=q.Content;opt.textContent=q.Question;practice_questionSelect.appendChild(opt)})}
function practice_generateQuestion(){const selectedContentUrl=practice_questionSelect.value;if(!selectedContentUrl||selectedContentUrl.includes('Select a Theme')||selectedContentUrl.includes('No Questions')){practice_questionDisplay.innerHTML=`<h2>Please select a Question.</h2><p>Please select a Theme first, then select a Question from the list.</p>`;return}const q=practice_allQuestions.find(item=>item.Content===selectedContentUrl);if(!q){practice_questionDisplay.innerHTML=`<p>Error: Content not found.</p>`;return}fullscreenBtn.classList.add('hide');fullscreenBtn.onclick=null;let contentHtml=q.Content;const originalUrl=q.Content;if(originalUrl&&originalUrl.includes('google.com/presentation')){const fileIdMatch=originalUrl.match(/\/d\/([a-zA-Z0-9_-]+)/);const slideIdMatch=originalUrl.match(/[?#]slide=id\.([a-zA-Z0-9_.-]+)/);if(fileIdMatch){const fileId=fileIdMatch[1];let embedUrl,presentUrl;if(slideIdMatch){const slideId=`id.${slideIdMatch[1]}`;embedUrl=`https://docs.google.com/presentation/d/${fileId}/embed?start=false&loop=false&slide=${slideId}`;presentUrl=`https://docs.google.com/presentation/d/${fileId}/present#slide=${slideId}`}else{embedUrl=`https://docs.google.com/presentation/d/${fileId}/embed?start=false&loop=false`;presentUrl=`https://docs.google.com/presentation/d/${fileId}/present`}contentHtml=`<iframe src="${embedUrl}" allowfullscreen></iframe>`;fullscreenBtn.classList.remove('hide');fullscreenBtn.onclick=()=>{window.open(presentUrl,'_blank')}}}practice_questionDisplay.innerHTML=`<h2>${q.Question}</h2>${contentHtml}`}
function resetVocabDropdowns(disabled){vocab_themeSelect.disabled=disabled;vocab_setSelect.disabled=disabled;vocab_setSelect2.disabled=disabled;if(disabled){vocab_themeSelect.innerHTML='<option>Select Class first</option>';vocab_setSelect.innerHTML='';vocab_setSelect2.innerHTML=''}}
function vocab_initializeSelectors(){const themes=Object.keys(vocab_vocabSets);vocab_themeSelect.innerHTML='<option value="">-- Select Theme --</option>';if(themes.length===0){vocab_themeSelect.innerHTML=`<option>No Themes Loaded</option>`;return}themes.sort().forEach(theme=>{const opt=document.createElement('option');opt.value=theme;opt.textContent=theme;vocab_themeSelect.appendChild(opt)});if(themes.length>0){vocab_themeSelect.value=themes.sort()[0]}vocab_updateSetDropdown()}
function vocab_updateSetDropdown(){const theme=vocab_themeSelect.value;vocab_setSelect.innerHTML='<option value="">-- Select Set --</option>';vocab_setSelect2.innerHTML='';const none=document.createElement('option');none.value='';none.textContent='-- None --';vocab_setSelect2.appendChild(none);if(!theme||!vocab_vocabSets[theme])return;const sets=Object.keys(vocab_vocabSets[theme]);sets.sort().forEach(setName=>{const wordCount=vocab_vocabSets[theme][setName].length;const opt1=document.createElement('option');opt1.value=setName;opt1.textContent=`${setName} (${wordCount} words)`;vocab_setSelect.appendChild(opt1);vocab_setSelect2.appendChild(opt1.cloneNode(true))})}
function createVocabTableRows(shuffledWords){let html='';const quizItems=shuffledWords.slice(0,10);const targetFirstQuestions=quizItems.slice(0,5);const englishFirstQuestions=quizItems.slice(5,10);targetFirstQuestions.forEach((item,i)=>{html+=`<tr><td class="num-cell">${i+1}</td><td>${item.target}</td><td class="answer-cell"><span>${item.english}</span></td></tr>`});englishFirstQuestions.forEach((item,i)=>{const rowNumber=targetFirstQuestions.length+i+1;html+=`<tr><td class="num-cell">${rowNumber}</td><td class="answer-cell"><span>${item.target}</span></td><td>${item.english}</td></tr>`});return html}
function vocab_generateTest(){const selectedTheme=vocab_themeSelect.value;const set1=vocab_setSelect.value;if(!selectedTheme||!set1)return;let combined=[...vocab_vocabSets[selectedTheme][set1]];const set2=vocab_setSelect2.value;if(set2&&set2!==set1){combined=combined.concat(vocab_vocabSets[selectedTheme][set2])}let uniqueCombined=Array.from(new Map(combined.map(item=>[item.target,item])).values());if(uniqueCombined.length<10){alert(`Need at least 10 unique words to create a quiz. Found ${uniqueCombined.length}.`);return}const shuffled=uniqueCombined.sort(()=>0.5-Math.random());const tableRowsHtml=createVocabTableRows(shuffled);vocab_testBody.innerHTML=tableRowsHtml;vocab_testContainer.classList.remove('hide');vocab_testControls.classList.remove('hide');vocab_revealBtn.textContent='Reveal Answers';document.querySelectorAll('#vocab-test-container .answer-cell span').forEach(s=>s.classList.remove('visible'))}
function vocab_revealAnswers(){const answers=document.querySelectorAll('#vocab-test-container .answer-cell span');const isVisible=answers.length>0&&answers[0].classList.contains('visible');if(isVisible){answers.forEach(s=>s.classList.remove('visible'));vocab_revealBtn.textContent='Reveal Answers'}else{answers.forEach(s=>s.classList.add('visible'));vocab_revealBtn.textContent='Hide Answers'}}
function vocab_generatePrintVersion(){if(vocab_testBody.innerHTML===''){alert('Please generate a vocabulary list first.');return}const tableHeaderHtml='<thead><tr><th>No.</th><th>Target Language</th><th>English</th></tr></thead>';const tableBodyHtml=vocab_testBody.innerHTML;const fullTableHTML=`<table>${tableHeaderHtml}${tableBodyHtml}</table>`;vocab_testContainer.innerHTML=fullTableHTML;vocab_printCopyArea.innerHTML=fullTableHTML;document.title="Vocabulary Test - Print Version";window.print();vocab_printCopyArea.innerHTML='';document.title="Language Practice Hub"}

// --- Start the App ---
initializeApp();

</script>
</body>
</html>
