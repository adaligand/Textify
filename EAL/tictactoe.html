<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tic Tac Toe</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
Â  /* âœ… Updated body styles for background and centering */
Â  body {
Â  Â  font-family: Arial, sans-serif;
Â  Â  background-color: #f4f4f9;
Â  Â  display: flex;
Â  Â  justify-content: center;
Â  Â  align-items: center;
Â  Â  min-height: 100vh;
Â  Â  margin: 0;
Â  Â  padding: 20px;
Â  Â  box-sizing: border-box;
Â  }
Â Â 
Â  /* âœ… New wrapper for the white box effect */
Â  .game-wrapper {
Â  Â  Â  background-color: white;
Â  Â  Â  padding: 20px 40px;
Â  Â  Â  border-radius: 15px;
Â  Â  Â  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
Â  Â  Â  text-align: center;
Â  }

Â  #container { display: flex; justify-content: center; align-items: flex-start; gap: 20px; }
Â  #grid { display: grid; gap: 10px; }
Â  .cell {Â 
Â  Â  position: relative;Â 
Â  Â  width: 150px;Â Â 
Â  Â  height: 150px;Â Â 
Â  Â  border: 1px solid #999;Â 
Â  Â  border-radius: 10px;Â 
Â  Â  cursor: pointer;Â 
Â  }
Â .cell img {Â 
Â  width: 100%;Â 
Â  height: 100%;Â 
Â  object-fit: contain;
Â  border-radius: 10px;Â 
}
Â  .overlay {Â 
Â  Â  position: absolute;Â 
Â  Â  top:0; left:0;Â 
Â  Â  width:100%; height:100%;Â 
Â  Â  background-color: rgba(255,0,0,0.4);Â 
Â  Â  opacity:0;Â 
Â  Â  border-radius:10px;Â 
Â  Â  transition: opacity 0.3s;Â 
Â  Â  pointer-events: none;Â 
Â  }
Â  .mark {
Â  Â  position:absolute;
Â  Â  top:0; left:0;
Â  Â  width:100%; height:100%;
Â  Â  display:flex;
Â  Â  justify-content:center;
Â  Â  align-items:center;
Â  Â  font-size:200px;
Â  Â  font-weight:bold;
Â  Â  color:rgba(249, 249, 8, 0.871);Â 
Â  Â  pointer-events:none;
Â  Â  user-select:none;
Â  }
Â  #words { display:flex; flex-direction: column; gap:10px; }
Â  .word {Â 
Â  padding:5px 10px;Â 
Â  border:1px solid #ccc;Â 
Â  border-radius:5px;Â 
Â  cursor: grab;Â 
Â  background-color:#f0f0f0;Â 
Â  user-select:none;Â 
Â  width: 180px;
Â  text-align: center;
Â  box-sizing: border-box;
}
Â  #turn { margin-top:20px; font-size:20px; font-weight:bold; }
Â  #restart {Â 
Â  Â  margin-top:15px;Â 
Â  Â  padding:8px 15px;Â 
Â  Â  font-size:16px;Â 
Â  Â  border:1px solid #ccc;Â 
Â  Â  border-radius:5px;Â 
Â  Â  background-color:#f0f0f0;Â 
Â  Â  cursor:pointer;Â 
Â  Â  display:none;
Â  }

  /* âœ… ADDED: Styles for the new game mode selector */
Â  #controls { margin: 15px 0; }
Â  #controls label { margin-right: 10px; font-size: 1.1em; }
Â  #controls select { padding: 5px; border-radius: 5px; font-size: 1em; }
</style>
</head>
<body>

<div class="game-wrapper">
Â  Â  <h1>Tic Tac Toe</h1>

    <div id="controls">
        <label for="player-mode">Game Mode:</label>
        <select id="player-mode">
            <option value="pvp">Player vs Player</option>
            <option value="pvc">Player vs Computer</option>
        </select>
    </div>

Â  Â  <div id="container">
Â  Â  Â  <div id="grid"></div>
Â  Â  Â  <div id="words"></div>
Â  Â  </div>
Â  Â  <div id="turn">Turn: X</div>
Â  Â  <button id="restart">Restart Game</button>
</div>

<script>
let allItemPairs = [];
let turn = 'X';
let gameOver = false;
const grid = document.getElementById('grid');
const wordsDiv = document.getElementById('words');
const turnDiv = document.getElementById('turn');
const restartBtn = document.getElementById('restart');
const containerDiv = document.getElementById('container');

// âœ… ADDED: New state variables for CPU game
let playerMode = 'pvp';
let isComputerTurn = false;
const playerModeSelect = document.getElementById('player-mode');


const params = new URLSearchParams(window.location.search);
const sheetUrl = params.get('sheet');

if (!sheetUrl) {
Â  Â  document.querySelector('.game-wrapper').innerHTML = "<h1>âš ï¸ No sheet URL provided.</h1>";
} else {
Â  Â  Papa.parse(sheetUrl, {
Â  Â  Â  Â  download: true,
Â  Â  Â  Â  header: false,
Â  Â  Â  Â  skipEmptyLines: true,
Â  Â  Â  Â  complete: function(results) {
Â  Â  Â  Â  Â  Â  allItemPairs = []; // Clear for restarts
Â  Â  Â  Â  Â  Â  results.data.forEach((row, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (index === 0) return;
Â  Â  Â  Â  Â  Â  Â  Â  if (row[1] && row[2]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allItemPairs.push({ word: row[1].trim(), img: row[2].trim() });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  if (allItemPairs.length < 9) {
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('.game-wrapper').innerHTML = "<h1>âš ï¸ Not enough data. The game requires at least 9 rows in the spreadsheet.</h1>";
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  generateGame();
Â  Â  Â  Â  },
Â  Â  Â  Â  error: function(err) {
Â  Â  Â  Â  Â  Â  console.error(err);
Â  Â  Â  Â  Â  Â  document.querySelector('.game-wrapper').innerHTML = "<h1>âš ï¸ Error loading CSV file.</h1>";
Â  Â  Â  Â  }
Â  Â  });
}

function shuffle(array){
Â  for(let i=array.length-1;i>0;i--){
Â  Â  const j=Math.floor(Math.random()*(i+1));
Â  Â  [array[i],array[j]]=[array[j],array[i]];
Â  }
Â  return array;
}

// âœ… ADDED: Helper function for turn text
function updateTurnText() {
    if (playerMode === 'pvc') {
        turnDiv.textContent = turn === 'X' ? "Turn: Player" : "Turn: Computer";
    } else {
        turnDiv.textContent = turn === 'X' ? "Turn: Player X" : "Turn: Player O";
    }
}

function checkWinner(){
Â  const cells = [...document.querySelectorAll('.cell .mark')].map(m=>m.textContent);
Â  const winPatterns = [
Â  Â  [0,1,2],[3,4,5],[6,7,8], // rows
Â  Â  [0,3,6],[1,4,7],[2,5,8], // cols
Â  Â  [0,4,8],[2,4,6]Â  Â  Â  Â  // diagonals
Â  ];
Â  for(const pattern of winPatterns){
Â  Â  const [a,b,c] = pattern;
Â  Â  if(cells[a] && cells[a]===cells[b] && cells[a]===cells[c]){
      // ğŸ”¶ MODIFIED: To show "Computer" as winner
Â  Â  Â  turnDiv.textContent = (playerMode === 'pvc' && cells[a] === 'O' ? 'Computer' : (cells[a] === 'X' ? 'Player X' : 'Player O')) + " wins!";
Â  Â  Â  gameOver = true;
Â  Â  Â  restartBtn.style.display = "inline-block";
      containerDiv.style.pointerEvents = 'auto'; // Ensure interaction is re-enabled
Â  Â  Â  return true;
Â  Â  }
Â  }
Â  if(cells.every(c=>c)){ // draw
Â  Â  turnDiv.textContent = "It's a draw!";
Â  Â  gameOver = true;
Â  Â  restartBtn.style.display = "inline-block";
    containerDiv.style.pointerEvents = 'auto';
Â  }
Â  return false;
}

function generateGame(){
Â  grid.innerHTML = '';
Â  wordsDiv.innerHTML = '';
Â  turn = 'X';
Â  gameOver = false;
Â  restartBtn.style.display = "none";
  containerDiv.style.pointerEvents = 'auto'; // Ensure UI is enabled

  // âœ… ADDED: Read player mode and reset CPU state
  playerMode = playerModeSelect.value;
  isComputerTurn = false;
  
  // ğŸ”¶ MODIFIED: Use new text function
Â  updateTurnText();

Â  let selected = shuffle([...allItemPairs]).slice(0,9);

Â  const columns = 3;
Â  grid.style.gridTemplateColumns = `repeat(${columns}, 150px)`;

Â  selected.forEach(pair=>{
Â  Â  const cell = document.createElement('div');
Â  Â  cell.className = 'cell';
Â  Â  cell.dataset.word = pair.word;

Â  Â  const img = document.createElement('img');
Â  Â  img.src = pair.img;
Â  Â  cell.appendChild(img);

Â  Â  const overlay = document.createElement('div');
Â  Â  overlay.className='overlay';
Â  Â  cell.appendChild(overlay);

Â  Â  const mark = document.createElement('div');
Â  Â  mark.className='mark';
Â  Â  cell.appendChild(mark);

Â  Â  cell.addEventListener('dragover',e=>e.preventDefault());
Â  Â  cell.addEventListener('drop',e=>{
      // ğŸ”¶ MODIFIED: Add guards for CPU turn
Â  Â  Â  if(gameOver || (playerMode === 'pvc' && turn === 'O')) return;

Â  Â  Â  const dragged = e.dataTransfer.getData('text');
Â  Â  Â  const wordEl = document.querySelector(`.word[data-word='${dragged}']`);
Â  Â  Â Â 
Â  Â  Â  if(dragged===cell.dataset.word && !mark.textContent){
Â  Â  Â  Â  mark.textContent = turn;
Â  Â  Â  Â  mark.style.color = turn==='X'?'rgba(255,100,100,0.7)':'rgba(100,100,255,0.7)';
Â  Â  Â  Â  if(wordEl) wordEl.remove();
Â  Â  Â  Â  if(!checkWinner()){
Â  Â  Â  Â  Â  turn = turn==='X'?'O':'X';
Â  Â  Â  Â  Â  updateTurnText();
          checkComputerMove(); // âœ… ADDED: Check if CPU should move
Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  overlay.style.opacity='0.7';
Â  Â  Â  Â  setTimeout(()=>overlay.style.opacity='0',500);
Â  Â  Â  Â  if(wordEl) wordsDiv.appendChild(wordEl);
Â  Â  Â  Â Â 
Â  Â  Â  Â  turn = turn==='X'?'O':'X';
Â  Â  Â  Â  updateTurnText();
        checkComputerMove(); // âœ… ADDED: Check if CPU should move
Â  Â  Â  }
Â  Â  });

Â  Â  grid.appendChild(cell);
Â  });

Â  shuffle(selected).forEach(pair=>{
Â  Â  const wordEl = document.createElement('div');
Â  Â  wordEl.className='word';
Â  Â  wordEl.textContent = pair.word;
Â  Â  wordEl.setAttribute('draggable','true');
Â  Â  wordEl.dataset.word=pair.word;
Â  Â  wordEl.addEventListener('dragstart',e=>{
Â  Â  Â  e.dataTransfer.setData('text',pair.word);
Â  Â  });
Â  Â  wordsDiv.appendChild(wordEl);
Â  });
}

// --- âœ… ADDED: COMPUTER LOGIC FUNCTIONS ---

/**
 * Checks if it's the computer's turn and triggers its move.
 */
function checkComputerMove() {
    if (!gameOver && playerMode === 'pvc' && turn === 'O') {
        isComputerTurn = true;
        containerDiv.style.pointerEvents = 'none'; // Disable player moves
        setTimeout(computerMove, 800); // Give a short delay for effect
    }
}

/**
 * The CPU's "brain". Finds and makes the best possible move.
 */
function computerMove() {
    if (gameOver) return;

    // 1. Try to find a winning move (for 'O')
    let move = findBestMove('O');
    
    // 2. If no win, try to block player's winning move (for 'X')
    if (!move) {
        move = findBestMove('X');
    }
    
    // 3. If neither, pick a valid random move
    if (!move) {
        const availableCells = [...document.querySelectorAll('.cell')].filter(c => !c.querySelector('.mark').textContent);
        if (availableCells.length > 0) {
            const randomCell = availableCells[Math.floor(Math.random() * availableCells.length)];
            const correctWord = randomCell.dataset.word;
            const wordEl = document.querySelector(`.word[data-word='${correctWord}']`);
            if (wordEl) {
                move = { cell: randomCell, wordEl: wordEl };
            }
        }
    }
    
    // Make the move
    if (move && move.cell && move.wordEl) {
        const mark = move.cell.querySelector('.mark');
        mark.textContent = 'O'; // CPU is 'O'
        mark.style.color = 'rgba(100,100,255,0.7)';
        move.wordEl.remove(); // Remove the word from the list
        
        if (!checkWinner()) {
            turn = 'X'; // Back to player
            updateTurnText();
            isComputerTurn = false;
            containerDiv.style.pointerEvents = 'auto'; // Re-enable player moves
        }
    } else {
        // Fallback in case no move can be made (e.g., words bug)
        isComputerTurn = false;
        containerDiv.style.pointerEvents = 'auto';
    }
}

/**
 * Finds a winning or blocking move.
 * @param {string} player - The player to check for ('X' or 'O').
 * @returns {object|null} - An object {cell, wordEl} or null.
 */
function findBestMove(player) {
    const cells = [...document.querySelectorAll('.cell')];
    const marks = cells.map(c => c.querySelector('.mark').textContent);
    const winPatterns = [
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
    ];
    
    for (const pattern of winPatterns) {
        const [a, b, c] = pattern;
        const spots = [marks[a], marks[b], marks[c]];
        const [cellA, cellB, cellC] = [cells[a], cells[b], cells[c]];
        
        // Find the empty spot in a "two-in-a-row" pattern
        if (spots[0] === player && spots[1] === player && !spots[2]) {
            const wordEl = document.querySelector(`.word[data-word='${cellC.dataset.word}']`);
            if (wordEl) return { cell: cellC, wordEl: wordEl };
        }
        if (spots[0] === player && spots[2] === player && !spots[1]) {
            const wordEl = document.querySelector(`.word[data-word='${cellB.dataset.word}']`);
            if (wordEl) return { cell: cellB, wordEl: wordEl };
        }
        if (spots[1] === player && spots[2] === player && !spots[0]) {
            const wordEl = document.querySelector(`.word[data-word='${cellA.dataset.word}']`);
            if (wordEl) return { cell: cellA, wordEl: wordEl };
        }
    }
    return null; // No winning/blocking move found
}
// --- END COMPUTER LOGIC ---

restartBtn.addEventListener('click', generateGame);
// âœ… ADDED: Listen for game mode changes to restart the game
playerModeSelect.addEventListener('change', generateGame);

</script>
</body>
</html>
