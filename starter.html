<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>Language Hub</title>
Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
Â  <style>
Â  Â  body {
Â  Â  Â  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
Â  Â  Â  background-color: #f0f2f5;
Â  Â  Â  color: #1c1e21;
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 20px;
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: center;
Â  Â  Â  align-items: flex-start;
Â  Â  Â  min-height: 100vh;
Â  Â  }
Â  Â  .container {
Â  Â  Â  width: 100%;
Â  Â  Â  max-width: 1400px;
Â  Â  Â  background: #fff;
Â  Â  Â  padding: 25px 30px;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
Â  Â  }
Â  Â  h1, h2 { text-align: center; color: #333; }
Â  Â  .hide { display: none !important; }

Â  Â  /* --- MENU --- */
Â  Â  #main-menu { text-align: center; }
Â  Â  #main-menu .menu-buttons {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: center;
Â  Â  Â  gap: 20px;
Â  Â  Â  margin-top: 30px;
Â  Â  }
Â  Â  .menu-button {
Â  Â  Â  font-size: 1.2em;
Â  Â  Â  padding: 20px 40px;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  border: none;
Â  Â  Â  color: white;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: transform 0.2s, box-shadow 0.2s;
Â  Â  }
Â  Â  .menu-button:hover {
Â  Â  Â  transform: translateY(-3px);
Â  Â  Â  box-shadow: 0 6px 15px rgba(0,0,0,0.15);
Â  Â  }
Â  Â  #reading-btn { background-color: #2980b9; }
Â  Â  #listening-btn { background-color: #27ae60; }
Â  Â  #vocab-btn { background-color: #8e44ad; }

Â  Â  /* --- BUTTON STYLE --- */
Â  Â  button {
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  font-size: 1em;
Â  Â  Â  font-weight: 600;
Â  Â  Â  cursor: pointer;
Â  Â  Â  padding: 12px 20px;
Â  Â  Â  transition: background-color 0.2s ease, transform 0.1s ease;
Â  Â  Â  white-space: nowrap;
Â  Â  }
Â  Â  button:hover { transform: translateY(-2px); }
Â  Â  .btn-primary { background-color: #2980b9; color: #fff; }
Â  Â  .btn-primary:hover { background-color: #3498db; }
Â  Â  .btn-secondary {
Â  Â  Â  background-color: #6c757d;
Â  Â  Â  color: white;
Â  Â  }
Â  Â  .btn-secondary:hover {
Â  Â  Â  background-color: #5a6268;
Â  Â  }

Â  Â  /* --- PRACTICE --- */
Â  Â  .practice-controls {
Â  Â  Â  display: flex;
Â  Â  Â  gap: 15px;
Â  Â  Â  margin-bottom: 25px;
Â  Â  Â  align-items: flex-end;
Â  Â  Â  flex-wrap: wrap; 
Â  Â  }
Â  Â  .practice-control-group {
Â  Â  Â  flex-grow: 1;
Â  Â  Â  min-width: 200px; 
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  }
Â  Â  label { font-weight: 600; margin-bottom: 8px; color: #606770; }
Â  Â  select {
Â  Â  Â  font-size: 16px;
Â  Â  Â  padding: 12px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  border: 1px solid #dddfe2;
Â  Â  Â  background-color: #f5f6f7;
Â  Â  }
Â  Â  #question-display {
Â  Â  Â  border: 1px solid #e0e0e0;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  padding: 20px;
Â  Â  Â  min-height: 400px;
Â  Â  Â  background-color: #fafafa;
Â  Â  }
Â  Â  #question-display iframe {
Â  Â  Â  width: 100%;
Â  Â  Â  height: 500px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  border: none;
Â  Â  }

Â  Â  /* --- VOCAB CLASS SELECTION --- (New styles merged from standalone code)*/
Â  Â  #vocab-selection-screen {
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  gap: 20px;
Â  Â  Â  Â  padding: 50px 0;
Â  Â  }
Â  Â  .selection-tile {
Â  Â  Â  Â  flex: 0 0 45%;Â 
Â  Â  Â  Â  min-width: 300px;
Â  Â  Â  Â  background-color: #4b2a65; /* Darker purple for hub integration */
Â  Â  Â  Â  color: white;
Â  Â  Â  Â  padding: 40px 20px;
Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  font-size: 1.5em; /* Slightly smaller than standalone */
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
Â  Â  Â  Â  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
Â  Â  }
Â  Â  .selection-tile:hover {
Â  Â  Â  Â  background-color: #8e44ad;
Â  Â  Â  Â  transform: translateY(-5px);
Â  Â  Â  Â  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
Â  Â  }

Â  Â  /* --- VOCAB TEST VIEW --- */
Â  Â  .vocab-main-wrapper { display: flex; gap: 30px; margin-top: 20px; }
Â  Â  .vocab-test-panel { flex-grow: 1; }
Â  Â  .vocab-controls-panel {
Â  Â  Â  flex: 0 0 300px;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  gap: 15px;
Â  Â  }
Â  Â  .vocab-control-group {
Â  Â  Â  background-color: #f9f9f9;
Â  Â  Â  border: 1px solid #ddd;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  padding: 20px;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  gap: 15px;
Â  Â  }
Â  Â  #vocab-test-container table {
Â  Â  Â  width: 100%;
Â  Â  Â  border-collapse: collapse;
Â  Â  Â  font-size: 1.4em;
Â  Â  Â  table-layout: fixed; 
Â  Â  }
Â  Â  #vocab-test-container th, #vocab-test-container td {
Â  Â  Â  border: 1px solid #ddd;
Â  Â  Â  padding: 12px;
Â  Â  Â  text-align: left;
Â  Â  }
Â  Â  #vocab-test-container th:first-child,
Â  Â  #vocab-test-container td.num-cell {
Â  Â  Â  width: 60px;
Â  Â  Â  text-align: center;
Â  Â  }
Â  Â  .answer-cell span { visibility: hidden; color: #27ae60; font-weight: bold; }
Â  Â  .answer-cell span.visible { visibility: visible; }
Â  Â  #vocab-test-controls button:nth-child(1) { background-color: #27ae60; }
Â  Â  #vocab-test-controls button:nth-child(1):hover { background-color: #2ecc71; }
Â  Â  #vocab-test-controls button:nth-child(2) { background-color: #e67e22; }
Â  Â  #vocab-test-controls button:nth-child(2):hover { background-color: #f39c12; }

Â  Â  /* --- PRINT --- */
Â  Â  @media print {
Â  Â  Â  Â  @page { size: A4 landscape; margin: 1cm; }
Â  Â  Â  Â  .container, #main-menu, #practice-section, #vocab-controls-panel { display: none !important; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #vocab-section {Â 
Â  Â  Â  Â  Â  Â  display: block !important;Â 
Â  Â  Â  Â  Â  Â  position: absolute;Â 
Â  Â  Â  Â  Â  Â  top: 0;Â 
Â  Â  Â  Â  Â  Â  left: 0;Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  padding: 0;Â 
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  }

        /* Use the print-area element for the print content */
        #vocab-print-area {
            display: flex !important;
            justify-content: space-around;
            gap: 10px;
            width: 100%;
            height: 98vh; 
            padding: 0;
        }

        .print-table-wrapper {
            width: 49%;
            page-break-inside: avoid;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
        }

        #vocab-print-area table {
            font-size: 12pt;
            border-collapse: collapse;
            width: 100%;
            height: 100%;
            table-layout: fixed;
        }

        #vocab-print-area th, #vocab-print-area td {
            border: 1px solid #000;
            padding: 6px 8px;
            height: 10%;
        }

Â  Â  Â  Â  .answer-cell span {Â 
Â  Â  Â  Â  Â  Â  visibility: hidden !important;Â 
Â  Â  Â  Â  }
Â  Â  }
Â  </style>
</head>
<body>
<div class="container">
Â  <div id="main-menu">
Â  Â  <h1>Language Practice Hub</h1>
Â  Â  <p>Please choose an activity</p>
Â  Â  <div class="menu-buttons">
Â  Â  Â  <button id="reading-btn" class="menu-button">Reading Practice</button>
Â  Â  Â  <button id="listening-btn" class="menu-button">Listening Practice</button>
Â  Â  Â  <button id="vocab-btn" class="menu-button">Vocabulary Test</button>
Â  Â  </div>
Â  </div>

Â  <div id="practice-section" class="hide">
Â  Â  <h1 id="practice-title">Practice Section</h1>
Â  Â  <input type="hidden" id="current-practice-type" value="">
Â  Â  <div class="practice-controls">
Â  Â  Â  <div class="practice-control-group">
Â  Â  Â  Â  <label for="topic-select">Choose a Theme:</label>
Â  Â  Â  Â  <select id="topic-select"><option>Loading Themes...</option></select>
Â  Â  Â  </div>
Â  Â  Â  <div class="practice-control-group">
Â  Â  Â  Â  <label for="question-select">Choose a Question:</label>
Â  Â  Â  Â  <select id="question-select"><option>Select a Theme first...</option></select>
Â  Â  Â  </div>
Â  Â  Â  <button id="generate-practice-btn" class="btn-primary">Load Question</button>
Â  Â  Â  <button id="fullscreen-btn" class="btn-primary hide">ğŸ”ˆ Open Full Screen</button>
Â  Â  Â  <button class="btn-secondary back-btn">Back to Main Menu</button>
Â  Â  </div>
Â  Â  <div id="question-display">
Â  Â  Â  <h2>Your question will appear here</h2>
Â  Â  Â  <p>Select a theme and question, then click "Load Question".</p>
Â  Â  </div>
Â  </div>

Â  <div id="vocab-section" class="hide">
Â  Â  Â  <h1 id="vocab-title" style="text-align: center;">Select Your Class/Set</h1>

Â  Â  Â  Â  Â  Â  <div id="vocab-selection-screen">
Â  Â  Â  Â  Â Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="vocab-test-wrapper" class="hide">
            <p id="vocab-loading-message" style="text-align:center;">Loading sets from your spreadsheet...</p>
            <div class="vocab-main-wrapper">
                <div class="vocab-test-panel">
                    <div id="vocab-test-container" class="hide">
                        <table>
                            <thead><tr><th>No.</th><th>Target Language</th><th>English</th></tr></thead>
                            <tbody id="vocab-test-body"></tbody>
                        </table>
                    </div>
                    <div id="vocab-print-area" class="hide"></div> 
                </div>

                <div class="vocab-controls-panel" id="vocab-controls-panel">
                    <h1 id="vocab-current-title">Vocabulary Test</h1>
                    <div id="vocab-setup-controls" class="vocab-control-group hide">
                        <label for="vocab-theme-select">1. Choose Theme:</label><select id="vocab-theme-select"></select>
                        <label for="vocab-set-select">2. Choose Set:</label><select id="vocab-set-select"></select>
                        <label for="vocab-set-select-2">3. 2nd set (Optional):</label><select id="vocab-set-select-2"></select>
                        <button id="vocab-generate-btn" class="btn-primary">Generate List</button>
                    </div>
                    <div id="vocab-test-controls" class="vocab-control-group hide">
                        <button id="vocab-reveal-btn" class="btn-primary">Reveal Answers</button>
                        <button id="vocab-print-btn" class="btn-primary">ğŸ–¨ï¸ Print Test</button>
                    </div>
                    <button id="vocab-back-btn" class="btn-primary">Back to Class Select</button>
                </div>
            </div>
Â  Â  Â  </div>
Â  </div>
</div>

<script>
// --- CONFIGURATION: SPREADSHEET URLs ---
// These are the 6 vocab spreadsheet URLs that define your "classes"
const spreadsheetUrls = {
Â  Â  'Y9 French': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRnDLxwYIiKui39_UjS66eQtrFttct-nEpnEcD06p15Bm9iNpxdFihDfj6BxggMLLukIyJ72SeF_EEM/pub?output=csv',Â 
Â  Â  'GCSE French': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSCNeq329ih6SxLZ2TowPzpk61gJLFy-UAVAb8ivBs9DNEOdmtRQ29bWh__n53MdE-C8hs_XOV3iIkT/pub?output=csv',Â 
Â  Â  'AS French':Â  Â 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRrT8UxOP9RIX0Udy7Q12-D2HJJVp8jfpd8lnbGO9vlHsXnWgtVeJlTXarZlROdR7cvc-Wug2ukblC8/pub?output=csv',Â  Â 
Â  Â  'A2 French':Â  Â 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRbdjmR3pBk7FniGAuKvlKQk_1zfuY9XlyhQtim-ABIdxEWk-8WmcUHxcDwOui7d1R0Uvk66LTr6eON/pub?output=csv',Â  Â  Â Â 
Â  Â  'Y9 German': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS2uwRf4d6BaS3Pr8s5Kh6l5qcueQdIypB4rB_gQVO1WNNC21wfcAALqUVflppBR5TaCFgBLFI8yCpF/pub?output=csv',
Â  Â  'GCSE German': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTlddh1-sO5-s5CPJt_a1H1ltX9orRCFvosUPVBJIqjxXc0nB3c4-f19sUNF5s6lIof7TnBIevleWJA/pub?output=csv'
};


// --- Hub URLs and Global Variables (Keeping practice sheet)---
const practiceSheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRvNFlHDx-4cZbDzwKy5Yb_DKeSxS2wSXxyX1Ua6pGcf27yFjmqOPz9jQ_rzoV3-zoZI9lw4EIfmdXH/pub?output=csv";
let practice_allQuestions = [];

// Vocab Globals
let vocab_vocabSets = {}; // Structure: { 'Topic Name': { 'Set Number': [{target: 'x', english: 'y'}, ...] } }
let vocab_currentSheetUrl = null; 
let vocab_currentQuizType = null;


// --- DOM Element References ---
const mainMenu = document.getElementById('main-menu');
const practiceSection = document.getElementById('practice-section');
const vocabSection = document.getElementById('vocab-section');
const readingBtn = document.getElementById('reading-btn');
const listeningBtn = document.getElementById('listening-btn');
const vocabBtn = document.getElementById('vocab-btn');
const currentPracticeTypeInput = document.getElementById('current-practice-type');

// Practice Section Refs
const practice_topicSelect = document.getElementById('topic-select'); 
const practice_questionSelect = document.getElementById('question-select'); 
const practice_generateBtn = document.getElementById('generate-practice-btn');
const practice_questionDisplay = document.getElementById('question-display');
const fullscreenBtn = document.getElementById('fullscreen-btn');

// Vocab Section Refs
const vocab_selectionScreen = document.getElementById('vocab-selection-screen');
const vocab_testWrapper = document.getElementById('vocab-test-wrapper');
const vocab_title = document.getElementById('vocab-title');
const vocab_currentTitle = document.getElementById('vocab-current-title');
const vocab_loadingMessage = document.getElementById('vocab-loading-message');
const vocab_themeSelect = document.getElementById('vocab-theme-select');
const vocab_setSelect = document.getElementById('vocab-set-select');
const vocab_setSelect2 = document.getElementById('vocab-set-select-2');
const vocab_generateBtn = document.getElementById('vocab-generate-btn');
const vocab_testContainer = document.getElementById('vocab-test-container');
const vocab_testBody = document.getElementById('vocab-test-body');
const vocab_setupControls = document.getElementById('vocab-setup-controls');
const vocab_testControls = document.getElementById('vocab-test-controls');
const vocab_revealBtn = document.getElementById('vocab-reveal-btn');
const vocab_printBtn = document.getElementById('vocab-print-btn');
const vocab_printArea = document.getElementById('vocab-print-area');
const vocab_backBtn = document.getElementById('vocab-back-btn');


// --- Navigation ---
readingBtn.addEventListener('click', () => showPractice('Reading'));
listeningBtn.addEventListener('click', () => showPractice('Listening'));
vocabBtn.addEventListener('click', showVocabSelect);
document.querySelectorAll('.back-btn').forEach(btn => btn.addEventListener('click', showMainMenu));
vocab_backBtn.addEventListener('click', showVocabSelect); // Navigate back to the Class selection screen


function showMainMenu() {
Â  Â  mainMenu.classList.remove('hide');
Â  Â  practiceSection.classList.add('hide');
Â  Â  vocabSection.classList.add('hide');
}

function showPractice(type) {
Â  Â  mainMenu.classList.add('hide');
Â  Â  practiceSection.classList.remove('hide');
Â  Â  vocabSection.classList.add('hide');
Â  Â  document.getElementById('practice-title').textContent = `${type} Practice`;
Â  Â  currentPracticeTypeInput.value = type;
Â  Â  practice_populateTopics();
}

// NEW FUNCTION: Show the Class Selection Screen
function showVocabSelect() {
Â  Â  mainMenu.classList.add('hide');
Â  Â  practiceSection.classList.add('hide');
Â  Â  vocabSection.classList.remove('hide');

Â  Â  vocab_title.textContent = 'Select Your Class/Set';
Â  Â  vocab_selectionScreen.classList.remove('hide');
Â  Â  vocab_testWrapper.classList.add('hide');
Â  Â  vocab_testContainer.classList.add('hide');
Â  Â  vocab_setupControls.classList.add('hide');
Â  Â  vocab_testControls.classList.add('hide');
}

// Function to handle the class selection click and start the quiz loading
function startVocabQuiz(quizType, url) {
    vocab_currentQuizType = quizType;
    vocab_currentSheetUrl = url;
    
    // Hide selection, show quiz wrapper
    vocab_selectionScreen.classList.add('hide');
    vocab_testWrapper.classList.remove('hide');

    // Update title
    vocab_title.textContent = `${quizType} Vocab Test`;
    vocab_currentTitle.textContent = `${quizType} Vocab Test`;

    // Reset controls
    vocab_loadingMessage.classList.remove('hide');
    vocab_setupControls.classList.add('hide');
    vocab_testControls.classList.add('hide');
    vocab_testBody.innerHTML = '';
    
    // Load the specific vocab sheet
    loadVocabData(url);
}


// --- Data Loading ---
function loadData(url, options) {
Â  Â  return new Promise((resolve, reject) => {
Â  Â  Â  Â  Papa.parse(url, {
Â  Â  Â  Â  Â  Â  ...options,
Â  Â  Â  Â  Â  Â  download: true,
Â  Â  Â  Â  Â  Â  skipEmptyLines: true,
Â  Â  Â  Â  Â  Â  complete: (results) => resolve(results.data),
Â  Â  Â  Â  Â  Â  error: (err) => reject(err),
Â  Â  Â  Â  });
Â  Â  });
}

// Standalone Vocab's loadVocabData logic (adapted)
function loadVocabData(url) {
Â  Â  Papa.parse(url, {
Â  Â  Â  Â  download: true, header: false, skipEmptyLines: true,
Â  Â  Â  Â  complete: (results) => {
Â  Â  Â  Â  Â  Â  let currentTopicName = null;
Â  Â  Â  Â  Â  Â  let currentSetNumber = null;
Â  Â  Â  Â  Â  Â  vocab_vocabSets = {};Â 

Â  Â  Â  Â  Â  Â  results.data.forEach(row => {
Â  Â  Â  Â  Â  Â  Â  Â  const topicInRow = String(row[0] || '').trim();Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  const setNumberInRow = String(row[1] || '').trim(); 
Â  Â  Â  Â  Â  Â  Â  Â  const targetWord = String(row[3] || '').trim();Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  const englishWord = String(row[4] || '').trim();Â  Â  

Â  Â  Â  Â  Â  Â  Â  Â  if (topicInRow.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentTopicName = topicInRow;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentSetNumber = null;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!vocab_vocabSets[currentTopicName]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  vocab_vocabSets[currentTopicName] = {};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (setNumberInRow.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentSetNumber = setNumberInRow;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (currentTopicName && currentSetNumber && targetWord.length > 0 && englishWord.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!vocab_vocabSets[currentTopicName][currentSetNumber]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  vocab_vocabSets[currentTopicName][currentSetNumber] = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  vocab_vocabSets[currentTopicName][currentSetNumber].push({ target: targetWord, english: englishWord });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (Object.keys(vocab_vocabSets).length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  vocab_initializeSelectors();
Â  Â  Â  Â  Â  Â  Â  Â  vocab_loadingMessage.classList.add('hide');
Â  Â  Â  Â  Â  Â  Â  Â  vocab_setupControls.classList.remove('hide');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  vocab_loadingMessage.textContent = `âš ï¸ No vocabulary sets found for ${vocab_currentQuizType}. Check Columns A, B, D, and E in your spreadsheet.`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  },
Â  Â  Â  Â  error: () => {Â 
Â  Â  Â  Â  Â  Â  vocab_loadingMessage.textContent = `âš ï¸ Failed to load spreadsheet for ${vocab_currentQuizType}. Check the URL and public sharing settings.`;
Â  Â  Â  Â  Â  Â  // If load fails, give an easy way to go back to class select
Â  Â  Â  Â  Â  Â  vocab_backBtn.textContent = 'Go Back to Class Select'; 
Â  Â  Â  Â  }
Â  Â  });
}

async function initializeApp() {
Â  Â  readingBtn.disabled = true;
Â  Â  listeningBtn.disabled = true;
Â  Â  vocabBtn.disabled = true;
Â  Â  readingBtn.textContent = 'Loading...';

Â  Â  try {
Â  Â  Â  Â  const practiceData = await loadData(practiceSheetUrl, { header: true });

Â  Â  Â  Â  practice_allQuestions = practiceData.map(q => ({
Â  Â  Â  Â  Â  Â  Skill: q.Skill,
Â  Â  Â  Â  Â  Â  Theme: q.Theme,
Â  Â  Â  Â  Â  Â  Question: q.Question,
Â  Â  Â  Â  Â  Â  Content: q.Content
Â  Â  Â  Â  })).filter(q => q.Skill && q.Theme && q.Content);


Â  Â  Â  Â  // Populate the initial Vocab Class selection tiles
        const vocabSelectionContainer = document.getElementById('vocab-selection-screen');
        vocabSelectionContainer.innerHTML = ''; // Clear the initial content (if any)
        Object.keys(spreadsheetUrls).forEach(className => {
            const tile = document.createElement('div');
            tile.className = 'selection-tile';
            tile.textContent = className;
            const url = spreadsheetUrls[className];
            if (url && !url.includes('YOUR_')) {
                tile.addEventListener('click', () => startVocabQuiz(className, url));
            } else {
                tile.style.opacity = '0.5';
                tile.title = "URL not set in the code.";
                tile.style.cursor = 'not-allowed';
            }
            vocabSelectionContainer.appendChild(tile);
        });
Â  Â  Â  Â Â 
Â  Â  Â  Â  readingBtn.disabled = false;
Â  Â  Â  Â  listeningBtn.disabled = false;
Â  Â  Â  Â  vocabBtn.disabled = false;
Â  Â  Â  Â  readingBtn.textContent = 'Reading Practice';

Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Failed to load spreadsheet data:", error);
Â  Â  Â  Â  document.querySelector('.container').innerHTML = '<h1>Error</h1><p>Could not load Practice data from the spreadsheet. Please check the URL and make sure the sheet is published correctly.</p>';
Â  Â  }
}

// --- Practice Section Logic (Remains unchanged) ---
practice_topicSelect.addEventListener('change', practice_populateQuestions);
practice_generateBtn.addEventListener('click', practice_generateQuestion);

function practice_populateTopics() {
Â  Â  const selectedType = currentPracticeTypeInput.value;
Â  Â  const themes = [...new Set(practice_allQuestions.filter(q => q.Skill === selectedType).map(q => q.Theme))];Â 
Â  Â Â 
Â  Â  practice_topicSelect.innerHTML = '<option value="">-- Select Theme --</option>';Â 
Â  Â Â 
Â  Â  if (themes.length === 0) {
Â  Â  Â  Â  practice_topicSelect.innerHTML = `<option>No Themes Available</option>`;
Â  Â  Â  Â  practice_questionSelect.innerHTML = `<option>Select a Theme first...</option>`;
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  themes.sort().forEach(theme => {
Â  Â  Â  Â  if (theme) {Â 
Â  Â  Â  Â  Â  Â  const opt = document.createElement('option');
Â  Â  Â  Â  Â  Â  opt.value = theme;
Â  Â  Â  Â  Â  Â  opt.textContent = theme;
Â  Â  Â  Â  Â  Â  practice_topicSelect.appendChild(opt);
Â  Â  Â  Â  }
Â  Â  });
Â  Â  practice_populateQuestions();
}

function practice_populateQuestions() {
Â  Â  const selectedTheme = practice_topicSelect.value;
Â  Â  const selectedType = currentPracticeTypeInput.value;
Â  Â  practice_questionSelect.innerHTML = '';
Â  Â Â 
Â  Â  if (!selectedTheme) {
Â  Â  Â  Â  practice_questionSelect.innerHTML = `<option>Select a Theme first...</option>`;
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  const questions = practice_allQuestions.filter(q =>Â 
Â  Â  Â  Â  q.Skill === selectedType && q.Theme === selectedTheme
Â  Â  );

Â  Â  if (questions.length === 0) {
Â  Â  Â  Â  practice_questionSelect.innerHTML = `<option>No Questions Available</option>`;
Â  Â  Â  Â  return;
Â  Â  }
Â  Â Â 
Â  Â  questions.forEach((q) => {
Â  Â  Â  Â  const opt = document.createElement('option');
Â  Â  Â  Â  opt.value = q.Content;Â 
Â  Â  Â  Â  opt.textContent = q.Question;Â 
Â  Â  Â  Â  practice_questionSelect.appendChild(opt);
Â  Â  });
}

function practice_generateQuestion() {
Â  Â  const selectedContentUrl = practice_questionSelect.value;
Â  Â Â 
Â  Â  if (!selectedContentUrl) {
Â  Â  Â  Â  practice_questionDisplay.innerHTML = `<h2>Please select a Question.</h2><p>Please select a Theme first, then select a Question from the list.</p>`;
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  const q = practice_allQuestions.find(item => item.Content === selectedContentUrl);
Â  Â Â 
Â  Â  if (!q) {
Â  Â  Â  Â  practice_questionDisplay.innerHTML = `<p>Error: Content not found.</p>`;
Â  Â  Â  Â  return;
Â  Â  }
Â  Â Â 
Â  Â  fullscreenBtn.classList.add('hide');
Â  Â  fullscreenBtn.onclick = null;

Â  Â  let contentHtml = q.Content;
Â  Â  const originalUrl = q.Content;

Â  Â  if (originalUrl && originalUrl.includes('google.com/presentation')) {
Â  Â  Â  Â  const fileIdMatch = originalUrl.match(/\/d\/([a-zA-Z0-9_-]+)/);
Â  Â  Â  Â  const slideIdMatch = originalUrl.match(/[?#]slide=id\.([a-zA-Z0-9_.-]+)/);

Â  Â  Â  Â  if (fileIdMatch) {
Â  Â  Â  Â  Â  Â  const fileId = fileIdMatch[1];
Â  Â  Â  Â  Â  Â  let embedUrl;
Â  Â  Â  Â  Â  Â  let presentUrl;

Â  Â  Â  Â  Â  Â  if (slideIdMatch) {
Â  Â  Â  Â  Â  Â  Â  Â  const slideId = `id.${slideIdMatch[1]}`;
Â  Â  Â  Â  Â  Â  Â  Â  embedUrl = `https://docs.google.com/presentation/d/${fileId}/embed?start=false&loop=false&slide=${slideId}`;
Â  Â  Â  Â  Â  Â  Â  Â  presentUrl = `https://docs.google.com/presentation/d/${fileId}/present#slide=${slideId}`;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  embedUrl = `https://docs.google.com/presentation/d/${fileId}/embed?start=false&loop=false`;
Â  Â  Â  Â  Â  Â  Â  Â  presentUrl = `https://docs.google.com/presentation/d/${fileId}/present`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  contentHtml = `<iframe src="${embedUrl}" allowfullscreen></iframe>`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  fullscreenBtn.classList.remove('hide');
Â  Â  Â  Â  Â  Â  fullscreenBtn.onclick = () => { window.open(presentUrl, '_blank'); };
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  practice_questionDisplay.innerHTML = `<h2>${q.Question}</h2>${contentHtml}`;
}

// --- Vocabulary Section Logic (MODIFIED to use standalone code's functions) ---

function vocab_initializeSelectors() {
Â  Â  const topicNames = Object.keys(vocab_vocabSets);
Â  Â  vocab_themeSelect.innerHTML = '';
Â  Â Â 
Â  Â  topicNames.sort().forEach(topic => {
Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  option.value = topic;
Â  Â  Â  Â  option.textContent = topic;
Â  Â  Â  Â  vocab_themeSelect.appendChild(option);
Â  Â  });

Â  Â  if(topicNames.length === 0) {
Â  Â  Â  Â  vocab_themeSelect.innerHTML = '<option>No Topics Loaded</option>';
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  vocab_themeSelect.value = topicNames.sort()[0];Â 
Â  Â  vocab_updateSetDropdown();
}

function vocab_updateSetDropdown() {
Â  Â  const selectedTopic = vocab_themeSelect.value;Â 

Â  Â  vocab_setSelect.innerHTML = '';
Â  Â  vocab_setSelect2.innerHTML = '';

Â  Â  const noneOption = document.createElement('option');
Â  Â  noneOption.value = "";
Â  Â  noneOption.textContent = "-- None --";
Â  Â  vocab_setSelect2.appendChild(noneOption);

Â  Â  if (!selectedTopic || !vocab_vocabSets[selectedTopic]) {
Â  Â  Â  Â  vocab_setSelect.innerHTML = '<option>-- Select a Theme --</option>';
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  const setsInTopic = Object.keys(vocab_vocabSets[selectedTopic]).sort((a, b) => {
Â  Â  Â  Â  const numA = parseFloat(a);
Â  Â  Â  Â  const numB = parseFloat(b);
Â  Â  Â  Â  if (numA !== numB) return numA - numB;
Â  Â  Â  Â  return a.localeCompare(b);
Â  Â  });

Â  Â  setsInTopic.forEach(setNumber => {
Â  Â  Â  Â  const wordCount = vocab_vocabSets[selectedTopic][setNumber].length;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const option1 = document.createElement('option');
Â  Â  Â  Â  Â option1.value = setNumber;
Â  Â  Â  Â  Â option1.textContent = `${setNumber} (${wordCount} words)`;
Â  Â  Â  Â  Â vocab_setSelect.appendChild(option1);
Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â const option2 = option1.cloneNode(true);
Â  Â  Â  Â  Â vocab_setSelect2.appendChild(option2);
Â  Â  });
}

vocab_themeSelect.addEventListener('change', vocab_updateSetDropdown);
vocab_generateBtn.addEventListener('click', vocab_generateTest);
vocab_revealBtn.addEventListener('click', vocab_revealAnswers);
vocab_printBtn.addEventListener('click', vocab_generatePrintVersion);

function vocab_generateTest() {
Â  Â  const selectedTopic = vocab_themeSelect.value;
Â  Â  const selectedSetNumber1 = vocab_setSelect.value;
Â  Â  const selectedSetNumber2 = vocab_setSelect2.value;
Â  Â Â 
Â  Â  if (!selectedSetNumber1 || !selectedTopic) return;

Â  Â  let combinedSet = [...vocab_vocabSets[selectedTopic][selectedSetNumber1]];
Â  Â  if (selectedSetNumber2 && selectedSetNumber2 !== "") {
Â  Â  Â  Â  combinedSet = combinedSet.concat(vocab_vocabSets[selectedTopic][selectedSetNumber2]);
Â  Â  }
Â  Â Â 
Â  Â  const uniqueCombinedSet = Array.from(new Map(combinedSet.map(item => [item.target, item])).values());
Â  Â  if (uniqueCombinedSet.length === 0) return;

Â  Â  // Shuffle and take up to 10 words (5 for target, 5 for English)
Â  Â  const shuffled = [...uniqueCombinedSet].sort(() => 0.5 - Math.random());
Â  Â  const quizItems = shuffled.slice(0, 10);Â 

Â  Â  vocab_testBody.innerHTML = '';
Â  Â Â 
Â  Â  // 1. Generate the main on-screen table
Â  Â  quizItems.forEach((item, index) => {
Â  Â  Â  Â  Â const row = document.createElement('tr');
Â  Â  Â  Â  Â const rowNumber = index + 1;
Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â let targetCol, englishCol;
Â  Â  Â  Â  Â if (index < 5) { // Target -> English questions
Â  Â  Â  Â  Â  Â  Â targetCol = `<td>${item.target}</td>`;
Â  Â  Â  Â  Â  Â  Â englishCol = `<td class="answer-cell"><span class="answer">${item.english}</span></td>`;
Â  Â  Â  Â  Â } else { // English -> Target questions
Â  Â  Â  Â  Â  Â  Â targetCol = `<td class="answer-cell"><span class="answer">${item.target}</span></td>`;
Â  Â  Â  Â  Â  Â  Â englishCol = `<td>${item.english}</td>`;
Â  Â  Â  Â  Â }

Â  Â  Â  Â  Â row.innerHTML = `
Â  Â  Â  Â  Â  Â  Â <td class="num-cell">${rowNumber}</td>
Â  Â  Â  Â  Â  Â  Â ${targetCol}
Â  Â  Â  Â  Â  Â  Â ${englishCol}
Â  Â  Â  Â  Â `;
Â  Â  Â  Â  Â vocab_testBody.appendChild(row);
Â  Â  });
Â  Â Â 
Â  Â  // 2. Prepare the print area content (2 BLANK quizzes)
Â  Â  const onScreenTable = document.querySelector('#vocab-test-container table');
Â  Â  const tableHeaderHTML = onScreenTable.querySelector('thead').outerHTML;
Â  Â  const tableBodyHTML = onScreenTable.querySelector('tbody').innerHTML;
Â  Â  const fullTableHTML = `<table>${tableHeaderHTML}${tableBodyHTML}</table>`;

Â  Â  vocab_printArea.innerHTML = `
Â  Â  Â  Â  <div class="print-table-wrapper">${fullTableHTML}</div>
Â  Â  Â  Â  <div class="print-table-wrapper">${fullTableHTML}</div>
Â  Â  `;
Â  Â Â 
Â  Â  // --- DISPLAY CONTROLS ---
Â  Â  vocab_testContainer.classList.remove('hide');
Â  Â  vocab_testControls.classList.remove('hide');
Â  Â  vocab_revealBtn.textContent = 'Reveal Answers';
Â  Â  document.querySelectorAll('.answer').forEach(span => span.classList.remove('visible'));
}

function vocab_revealAnswers() {
Â  Â  const answers = document.querySelectorAll('#vocab-test-container .answer');
Â  Â  if (answers.length === 0) return;
Â  Â Â 
Â  Â  const isHidden = !answers[0].classList.contains('visible');
Â  Â  answers.forEach(span => {
Â  Â  Â  Â  span.classList.toggle('visible', isHidden);
Â  Â  });

Â  Â  vocab_revealBtn.textContent = isHidden ? 'Hide Answers' : 'Reveal Answers';
}

function vocab_generatePrintVersion() {
    window.print();
}


// --- Start the App ---
initializeApp();

</script>
</body>
</html>
