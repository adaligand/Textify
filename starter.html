<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Language Hub</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background-color: #f4f7f6;
    color: #333;
    font-size: 22px;
    margin: 0;
    padding: 20px;
}
.container {
    width: 95%;
    max-width: 1400px;
    margin: 0 auto;
    padding: 30px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    min-height: calc(100vh - 40px);
    display: flex;
    flex-direction: column;
}
h1 { color: #2c3e50; }
.hide { display: none !important; }
#loading-message, #loading-message-rl { text-align: center; }

/* --- HOME BUTTON STYLE --- */
button {
    padding: 12px 15px;
    font-size: 1em;
    width: auto;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.2s;
}
#home-btn, #home-btn-rl { background-color: #2980b9; color: white; }
#home-btn:hover, #home-btn-rl:hover { background-color: #3498db; }

/* --- Selection Screen --- */
#vocab-selection-screen {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    padding: 50px 0;
    flex-grow: 1;
}
.selection-tile {
    flex: 0 0 45%;
    min-width: 300px;
    background-color: #2980b9;
    color: white;
    padding: 40px 20px;
    border-radius: 15px;
    text-align: center;
    font-size: 2em;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}
.selection-tile:hover {
    background-color: #3498db;
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
}

/* --- Quiz & RL Panels --- */
.main-content-wrapper { display: flex; gap: 30px; margin-top: 20px; flex-grow: 1; }
.test-panel { flex-grow: 1; }
.controls-panel { flex: 0 0 300px; display: flex; flex-direction: column; gap: 15px; }
.controls-panel .control-group { background-color: #f9f9f9; border: 1px solid #ddd; border-radius: 8px; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
label { font-weight: bold; }
select, .controls-panel button { width: 100%; font-size: 1em; padding: 12px 15px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; }
.controls-panel button { background-color: #2980b9; color: white; }
.controls-panel button:hover { background-color: #3498db; }
#reveal-btn { background-color: #27ae60; }
#reveal-btn:hover { background-color: #2ecc71; }
#print-btn { background-color: #8e44ad; }
#print-btn:hover { background-color: #9b59b6; }
table { width: 100%; border-collapse: collapse; font-size: 1.4em; table-layout: fixed; }
th, td { border: 1px solid #ddd; padding: 12px; text-align: left; overflow-wrap: break-word; }
th { background-color: #f9f9f9; }
th:first-child, td.num-cell { width: 60px; text-align: center; }
td.num-cell { font-weight: bold; color: #7f8c8d; }
.answer-cell span { visibility: hidden; color: #27ae60; font-weight: bold; }
.answer-cell span.visible { visibility: visible; }

/* --- PRINT STYLES FOR VOCAB ONLY --- */
@media print {
    @page { size: landscape; margin: 1cm; }
    body { font-size: 10pt; padding:0; margin:0; background:white !important; }
    .container > :not(#print-area) { display:none !important; }
    .container { padding:0 !important; margin:0 !important; width:100% !important; max-width:none !important; min-height:auto !important; display:block !important; box-shadow:none !important; }
    #print-area { display:flex !important; justify-content:space-around; gap:10px; width:100%; height:98vh; padding:0; }
    .print-table-wrapper { width:49%; page-break-inside:avoid; display:flex; flex-direction:column; justify-content:space-between; height:100%; }
    #print-area table { font-size:12pt; border-collapse:collapse; width:100%; height:100%; table-layout:fixed; }
    #print-area th, #print-area td { border:1px solid #000; padding:6px 8px; height:10%; }
    #print-area .answer-cell span { visibility:hidden !important; }
    #print-area th:first-child, #print-area td.num-cell { width:40px; text-align:center; }
}
</style>
</head>
<body>
<div class="container">

<h1 id="main-title" style="text-align:center;">Select Your Language & Level</h1>

<div id="vocab-selection-screen">
    <div class="selection-tile" data-quiz-type="Y9 French">Year 9 French</div>
    <div class="selection-tile" data-quiz-type="GCSE French">GCSE French</div>
    <div class="selection-tile" data-quiz-type="AS French">AS French</div>
    <div class="selection-tile" data-quiz-type="A2 French">A2 French</div>
    <div class="selection-tile" data-quiz-type="Y9 German">Year 9 German</div>
    <div class="selection-tile" data-quiz-type="GCSE German">GCSE German</div>
    <div class="selection-tile" data-quiz-type="Reading/Listening">Reading/Listening</div>
</div>

<!-- VOCAB QUIZ WRAPPER -->
<div id="quiz-wrapper" class="hide">
    <p id="loading-message">Loading sets from your spreadsheet...</p>
    <div class="main-content-wrapper">
        <div class="test-panel">
            <div id="test-container" class="hide">
                <table>
                    <thead>
                        <tr><th>No.</th><th>Target Language</th><th>English</th></tr>
                    </thead>
                    <tbody id="test-body"></tbody>
                </table>
            </div>
        </div>
        <div class="controls-panel">
            <div class="setup-header">
                <h1 id="title">Vocab Test</h1>
                <button id="home-btn" class="hide">Home üè†</button>
            </div>
            <div id="setup-controls" class="control-group hide">
                <label for="theme-select">1. Choose Theme:</label><select id="theme-select"></select>
                <label for="set-select">2. Choose Set:</label><select id="set-select"></select>
                <label for="set-select-2">3. 2nd set (Optional):</label><select id="set-select-2"></select>
                <button id="generate-btn">Generate List</button>
            </div>
            <div id="test-controls" class="control-group hide">
                <button id="reveal-btn">Reveal Answers</button>
                <button id="print-btn">üñ®Ô∏è Print Test</button>
            </div>
        </div>
    </div>
</div>

<!-- VOCAB PRINT AREA -->
<div id="print-area" class="hide"></div>

<!-- READING/LISTENING WRAPPER -->
<div id="reading-listening-wrapper" class="hide">
    <p id="loading-message-rl">Loading sets from your spreadsheet...</p>
    <div class="main-content-wrapper">
        <div class="test-panel">
            <div id="question-container" class="hide">
                <label for="question-select">Select Question:</label>
                <select id="question-select"></select>
            </div>
        </div>
        <div class="controls-panel">
            <div class="setup-header">
                <h1 id="title-rl">Reading / Listening</h1>
                <button id="home-btn-rl">Home üè†</button>
            </div>
            <div id="setup-controls-rl" class="control-group hide">
                <label for="theme-select-rl">1. Choose Theme:</label>
                <select id="theme-select-rl"></select>
            </div>
        </div>
    </div>
</div>

<script>
const spreadsheetUrls = {
    'GCSE French':'https://docs.google.com/spreadsheets/d/e/2PACX-1vSCNeq329ih6SxLZ2TowPzpk61gJLFy-UAVAb8ivBs9DNEOdmtRQ29bWh__n53MdE-C8hs_XOV3iIkT/pub?output=csv',
    'GCSE German':'https://docs.google.com/spreadsheets/d/e/2PACX-1vTlddh1-sO5-s5CPJt_a1H1ltX9orRCFvosUPVBJIqjxXc0nB3c4-f19sUNF5s6lIof7TnBIevleWJA/pub?output=csv',
    'Y9 German':'https://docs.google.com/spreadsheets/d/e/2PACX-1vS2uwRf4d6BaS3Pr8s5Kh6l5qcueQdIypB4rB_gQVO1WNNC21wfcAALqUVflppBR5TaCFgBLFI8yCpF/pub?output=csv',
    'Y9 French':'https://docs.google.com/spreadsheets/d/e/2PACX-1vRnDLxwYIiKui39_UjS66eQtrFttct-nEpnEcD06p15Bm9iNpxdFihDfj6BxggMLLukIyJ72SeF_EEM/pub?output=csv',
    'AS French':'https://docs.google.com/spreadsheets/d/e/2PACX-1vRrT8UxOP9RIX0Udy7Q12-D2HJJVp8jfpd8lnbGO9vlHsXnWgtVeJlTXarZlROdR7cvc-Wug2ukblC8/pub?output=csv',
    'A2 French':'https://docs.google.com/spreadsheets/d/e/2PACX-1vRbdjmR3pBk7FniGAuKvlKQk_1zfuY9XlyhQtim-ABIdxEWk-8WmcUHxcDwOui7d1R0Uvk66LTr6eON/pub?output=csv',
    'Reading/Listening':'YOUR_READING_LISTENING_CSV_URL'
};

const selectionScreen = document.getElementById('vocab-selection-screen');
const mainTitle = document.getElementById('main-title');

// VOCAB DOM
const quizWrapper=document.getElementById('quiz-wrapper'), loadingMessage=document.getElementById('loading-message');
const setupControls=document.getElementById('setup-controls'), themeSelect=document.getElementById('theme-select');
const setSelect=document.getElementById('set-select'), setSelect2=document.getElementById('set-select-2');
const generateBtn=document.getElementById('generate-btn'), testContainer=document.getElementById('test-container');
const testBody=document.getElementById('test-body'), testControls=document.getElementById('test-controls');
const revealBtn=document.getElementById('reveal-btn'), printBtn=document.getElementById('print-btn');
const printArea=document.getElementById('print-area'), homeBtn=document.getElementById('home-btn');
const quizTitle=document.getElementById('title');

let vocabSets={};

// RL DOM
const rlWrapper=document.getElementById('reading-listening-wrapper');
const themeSelectRL=document.getElementById('theme-select-rl');
const questionSelect=document.getElementById('question-select');
const questionContainer=document.getElementById('question-container');
const homeBtnRL=document.getElementById('home-btn-rl');
const setupControlsRL=document.getElementById('setup-controls-rl');
const loadingMessageRL=document.getElementById('loading-message-rl');
let quizDataRL={};

document.addEventListener('DOMContentLoaded', ()=>{
    document.querySelectorAll('.selection-tile').forEach(tile=>{
        const type=tile.dataset.quizType;
        if(type==='Reading/Listening'){
            tile.addEventListener('click',()=>{
                mainTitle.classList.add('hide');
                selectionScreen.classList.add('hide');
                rlWrapper.classList.remove('hide');
                homeBtnRL.classList.remove('hide');
                loadReadingListeningData(spreadsheetUrls[type]);
            });
        } else if(spreadsheetUrls[type]){
            tile.addEventListener('click',()=>{
                mainTitle.classList.add('hide');
                selectionScreen.classList.add('hide');
                quizWrapper.classList.remove('hide');
                homeBtn.classList.remove('hide');
                quizTitle.textContent=`${type} Vocab Test`;
                loadVocabData(spreadsheetUrls[type]);
            });
        } else {
            tile.style.opacity='0.5';
            tile.title="URL not set in the code.";
            tile.style.cursor='not-allowed';
        }
    });

    generateBtn.addEventListener('click', generateTest);
    revealBtn.addEventListener('click', revealAnswers);
    themeSelect.addEventListener('change', updateSetDropdown);
    printBtn.addEventListener('click',()=>window.print());
    homeBtn.addEventListener('click',()=>window.location.reload());
});

// --- VOCAB FUNCTIONS ---
function loadVocabData(url){
    Papa.parse(url,{download:true,header:false,skipEmptyLines:true,
        complete:(results)=>{
            let currentTopicName=null,currentSetNumber=null;
            vocabSets={};
            results.data.forEach(row=>{
                const topic=row[0]?row[0].trim():null, set=row[1]?row[1].trim():null;
                const target=row[3]?row[3].trim():null, english=row[4]?row[4].trim():null;
                if(topic) currentTopicName=topic;
                if(set) currentSetNumber=set;
                if(currentTopicName && currentSetNumber && target && english){
                    if(!vocabSets[currentTopicName]) vocabSets[currentTopicName]={};
                    if(!vocabSets[currentTopicName][currentSetNumber]) vocabSets[currentTopicName][currentSetNumber]=[];
                    vocabSets[currentTopicName][currentSetNumber].push({target,english});
                }
            });
            if(Object.keys(vocabSets).length>0){ initializeSelectors(); loadingMessage.classList.add('hide'); setupControls.classList.remove('hide');}
            else loadingMessage.textContent="No vocabulary sets found.";
        },
        error:()=>{loadingMessage.textContent="Failed to load spreadsheet.";}
    });
}

function initializeSelectors(){
    themeSelect.innerHTML='';
    Object.keys(vocabSets).sort().forEach(topic=>{
        const opt=document.createElement('option'); opt.value=topic; opt.textContent=topic;
        themeSelect.appendChild(opt);
    });
    updateSetDropdown();
}

function updateSetDropdown(){
    const selectedTopic=themeSelect.value;
    setSelect.innerHTML=''; setSelect2.innerHTML='';
    const noneOption=document.createElement('option'); noneOption.value=""; noneOption.textContent="-- None --"; setSelect2.appendChild(noneOption);
    if(!selectedTopic || !vocabSets[selectedTopic]){
        setSelect.innerHTML='<option>-- Select a Theme --</option>';
        return;
    }
    Object.keys(vocabSets[selectedTopic]).sort((a,b)=>parseFloat(a)-parseFloat(b)).forEach(setNum=>{
        const option1=document.createElement('option'); option1.value=setNum; option1.textContent=`${setNum} (${vocabSets[selectedTopic][setNum].length} words)`; setSelect.appendChild(option1);
        const option2=option1.cloneNode(true); setSelect2.appendChild(option2);
    });
}

function generateTest(){
    const selectedTopic=themeSelect.value, s1=setSelect.value, s2=setSelect2.value;
    if(!selectedTopic || !s1) return;
    let combinedSet=[...vocabSets[selectedTopic][s1]];
    if(s2 && s2!=="") combinedSet=combinedSet.concat(vocabSets[selectedTopic][s2]);
    const uniqueSet=Array.from(new Map(combinedSet.map(i=>[i.target,i])).values());
    const shuffled=[...uniqueSet].sort(()=>0.5-Math.random());
    const quizItems=shuffled.slice(0,10);
    testBody.innerHTML='';
    quizItems.forEach((item,index)=>{
        const row=document.createElement('tr'); const rowNumber=index+1;
        let targetCol, englishCol;
        if(index<5){ targetCol=`<td>${item.target}</td>`; englishCol=`<td class="answer-cell"><span class="answer">${item.english}</span></td>`;}
        else{ targetCol=`<td class="answer-cell"><span class="answer">${item.target}</span></td>`; englishCol=`<td>${item.english}</td>`;}
        row.innerHTML=`<td class="num-cell">${rowNumber}</td>${targetCol}${englishCol}`;
        testBody.appendChild(row);
    });
    testContainer.classList.remove('hide');
    testControls.classList.remove('hide');
}

function revealAnswers(){
    document.querySelectorAll('.answer-cell span').forEach(span=>span.classList.add('visible'));
}

// --- READING/LISTENING FUNCTIONS ---
function loadReadingListeningData(url){
    loadingMessageRL.textContent="Loading...";
    Papa.parse(url,{download:true,header:false,skipEmptyLines:true,
        complete:(results)=>{
            quizDataRL={};
            results.data.forEach(row=>{
                const theme=String(row[1]||'').trim();
                const question=String(row[2]||'').trim();
                if(theme && question){ if(!quizDataRL[theme]) quizDataRL[theme]=[]; quizDataRL[theme].push(question);}
            });
            populateThemeDropdownRL();
            loadingMessageRL.classList.add('hide');
            setupControlsRL.classList.remove('hide');
        },
        error:()=>{
            loadingMessageRL.textContent="‚ö†Ô∏è Failed to load reading/listening data.";
            alert("Failed to load reading/listening spreadsheet.");
        }
    });
}

function populateThemeDropdownRL(){
    themeSelectRL.innerHTML='';
    const themes=Object.keys(quizDataRL).sort();
    themes.forEach(theme=>{
        const opt=document.createElement('option'); opt.value=theme; opt.textContent=theme; themeSelectRL.appendChild(opt);
    });
    if(themes.length>0){ themeSelectRL.value=themes[0]; updateQuestionDropdownRL();}
}

function updateQuestionDropdownRL(){
    const selectedTheme=themeSelectRL.value;
    questionSelect.innerHTML='';
    if(!selectedTheme || !quizDataRL[selectedTheme]){ questionSelect.innerHTML='<option>Select a theme first</option>'; questionContainer.classList.add('hide'); return;}
    quizDataRL[selectedTheme].forEach((q,index)=>{
        const opt=document.createElement('option'); opt.value=index; opt.textContent=q; questionSelect.appendChild(opt);
    });
    questionContainer.classList.remove('hide');
}
themeSelectRL.addEventListener('change',updateQuestionDropdownRL);
homeBtnRL.addEventListener('click',()=>{
    rlWrapper.classList.add('hide');
    selectionScreen.classList.remove('hide');
    themeSelectRL.innerHTML=''; questionSelect.innerHTML=''; questionContainer.classList.add('hide');
});
</script>
</body>
</html>
