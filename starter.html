<!DOCTYPE html>

<html lang="en">

<head>

Â  <meta charset="UTF-8" />

Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

Â  <title>Language Hub</title>

Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

Â  <style>

Â  Â  body {

Â  Â  Â  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;

Â  Â  Â  background-color: #f0f2f5;

Â  Â  Â  color: #1c1e21;

Â  Â  Â  margin: 0;

Â  Â  Â  padding: 20px;

Â  Â  Â  display: flex;

Â  Â  Â  justify-content: center;

Â  Â  Â  align-items: flex-start;

Â  Â  Â  min-height: 100vh;

Â  Â  }

Â  Â  .container {

Â  Â  Â  width: 100%;

Â  Â  Â  max-width: 1400px;

Â  Â  Â  background: #fff;

Â  Â  Â  padding: 25px 30px;

Â  Â  Â  border-radius: 12px;

Â  Â  Â  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);

Â  Â  }

Â  Â  h1, h2 { text-align: center; color: #333; }

Â  Â  .hide { display: none !important; }



Â  Â  /* --- MENU --- */

Â  Â  #main-menu { text-align: center; }

Â  Â  #main-menu .menu-buttons {

Â  Â  Â  display: flex;

Â  Â  Â  justify-content: center;

Â  Â  Â  gap: 20px;

Â  Â  Â  margin-top: 30px;

Â  Â  }

Â  Â  .menu-button {

Â  Â  Â  font-size: 1.2em;

Â  Â  Â  padding: 20px 40px;

Â  Â  Â  border-radius: 10px;

Â  Â  Â  border: none;

Â  Â  Â  color: white;

Â  Â  Â  cursor: pointer;

Â  Â  Â  transition: transform 0.2s, box-shadow 0.2s;

Â  Â  }

Â  Â  .menu-button:hover {

Â  Â  Â  transform: translateY(-3px);

Â  Â  Â  box-shadow: 0 6px 15px rgba(0,0,0,0.15);

Â  Â  }

Â  Â  #reading-btn { background-color: #2980b9; }

Â  Â  #listening-btn { background-color: #27ae60; }

Â  Â  #vocab-btn { background-color: #8e44ad; }



Â  Â  /* --- BUTTON STYLE --- */

Â  Â  button {

Â  Â  Â  border: none;

Â  Â  Â  border-radius: 8px;

Â  Â  Â  font-size: 1em;

Â  Â  Â  font-weight: 600;

Â  Â  Â  cursor: pointer;

Â  Â  Â  padding: 12px 20px;

Â  Â  Â  transition: background-color 0.2s ease, transform 0.1s ease;

Â  Â  Â  white-space: nowrap;

Â  Â  }

Â  Â  button:hover { transform: translateY(-2px); }

Â  Â  .btn-primary { background-color: #2980b9; color: #fff; }

Â  Â  .btn-primary:hover { background-color: #3498db; }

Â  Â  .btn-secondary {

Â  Â  Â  background-color: #6c757d;

Â  Â  Â  color: white;

Â  Â  }

Â  Â  .btn-secondary:hover {

Â  Â  Â  background-color: #5a6268;

Â  Â  }



Â  Â  /* --- PRACTICE --- */

Â  Â  .practice-controls {

Â  Â  Â  display: flex;

Â  Â  Â  gap: 15px;

Â  Â  Â  margin-bottom: 25px;

Â  Â  Â  align-items: flex-end;

Â  Â  Â  flex-wrap: wrap; /* Allows wrapping on smaller screens */

Â  Â  }

Â  Â  .practice-control-group {

Â  Â  Â  flex-grow: 1;

Â  Â  Â  min-width: 200px; /* Ensure selection boxes have a decent size */

Â  Â  Â  display: flex;

Â  Â  Â  flex-direction: column;

Â  Â  }

Â  Â  label { font-weight: 600; margin-bottom: 8px; color: #606770; }

Â  Â  select {

Â  Â  Â  font-size: 16px;

Â  Â  Â  padding: 12px;

Â  Â  Â  border-radius: 8px;

Â  Â  Â  border: 1px solid #dddfe2;

Â  Â  Â  background-color: #f5f6f7;

Â  Â  }

Â  Â  #question-display {

Â  Â  Â  border: 1px solid #e0e0e0;

Â  Â  Â  border-radius: 12px;

Â  Â  Â  padding: 20px;

Â  Â  Â  min-height: 400px;

Â  Â  Â  background-color: #fafafa;

Â  Â  }

Â  Â  #question-display iframe {

Â  Â  Â  width: 100%;

Â  Â  Â  height: 500px;

Â  Â  Â  border-radius: 8px;

Â  Â  Â  border: none;

Â  Â  }



Â  Â  /* --- VOCAB --- */

Â  Â  .vocab-main-wrapper { display: flex; gap: 30px; margin-top: 20px; }

Â  Â  .vocab-test-panel { flex-grow: 1; }

Â  Â  .vocab-controls-panel {

Â  Â  Â  flex: 0 0 300px;

Â  Â  Â  display: flex;

Â  Â  Â  flex-direction: column;

Â  Â  Â  gap: 15px;

Â  Â  }

Â  Â  .vocab-control-group {

Â  Â  Â  background-color: #f9f9f9;

Â  Â  Â  border: 1px solid #ddd;

Â  Â  Â  border-radius: 8px;

Â  Â  Â  padding: 20px;

Â  Â  Â  display: flex;

Â  Â  Â  flex-direction: column;

Â  Â  Â  gap: 15px;

Â  Â  }

Â  Â  #vocab-test-container table {

Â  Â  Â  width: 100%;

Â  Â  Â  border-collapse: collapse;

Â  Â  Â  font-size: 1.4em;

Â  Â  Â  table-layout: fixed; /* FIX for equal column spreading */

Â  Â  }

Â  Â  #vocab-test-container th, #vocab-test-container td {

Â  Â  Â  border: 1px solid #ddd;

Â  Â  Â  padding: 12px;

Â  Â  Â  text-align: left;

Â  Â  }

Â  Â  /* Column 1: Number (Fixed width) */

Â  Â  #vocab-test-container th:first-child,

Â  Â  #vocab-test-container td.num-cell {

Â  Â  Â  width: 60px;

Â  Â  Â  text-align: center;

Â  Â  }

Â  Â  /* Column 2 & 3: Target and English (Equal width) */

Â  Â  #vocab-test-container th:nth-child(2),

Â  Â  #vocab-test-container td:nth-child(2),

Â  Â  #vocab-test-container th:nth-child(3),

Â  Â  #vocab-test-container td:nth-child(3) {

Â  Â  Â  width: 47%;Â 

Â  Â  }



Â  Â  .answer-cell span { visibility: hidden; color: #27ae60; font-weight: bold; }

Â  Â  .answer-cell span.visible { visibility: visible; }



Â  Â  /* --- PRINT --- */

Â  Â  @media print {

Â  Â  Â  Â  /* Set page to landscape and adjust margins */

Â  Â  Â  Â  @page { size: A4 landscape; margin: 1cm; }

Â  Â  Â  Â Â 

Â  Â  Â  Â  /* Hide all user interface elements */

Â  Â  Â  Â  .container, #main-menu, #practice-section, #vocab-controls-panel { display: none !important; }

Â  Â  Â  Â Â 

Â  Â  Â  Â  /* Show only the vocab section for printing */

Â  Â  Â  Â  #vocab-section {Â 

Â  Â  Â  Â  Â  Â  display: block !important;Â 

Â  Â  Â  Â  Â  Â  position: absolute;Â 

Â  Â  Â  Â  Â  Â  top: 0;Â 

Â  Â  Â  Â  Â  Â  left: 0;Â 

Â  Â  Â  Â  Â  Â  width: 100%;Â 

Â  Â  Â  Â  Â  Â  padding: 0;Â 

Â  Â  Â  Â  Â  Â  margin: 0;

Â  Â  Â  Â  }



Â  Â  Â  Â  /* --- Quiz Grid Styling --- */

Â  Â  Â  Â  #vocab-test-container {

Â  Â  Â  Â  Â  Â  /* KEY FIX: Forces display even if it has the .hide class */

Â  Â  Â  Â  Â  Â  display: block !important;Â 

Â  Â  Â  Â  Â  Â  width: 100%;

Â  Â  Â  Â  Â  Â  /* Suggests a two-column print layout */

Â  Â  Â  Â  Â  Â  column-count: 2;

Â  Â  Â  Â  Â  Â  column-gap: 20px;

Â  Â  Â  Â  }



Â  Â  Â  Â  /* Apply table styling for print */

Â  Â  Â  Â  #vocab-test-container table {

Â  Â  Â  Â  Â  Â  width: 100%;

Â  Â  Â  Â  Â  Â  border-collapse: collapse;

Â  Â  Â  Â  Â  Â  font-size: 11pt;Â 

Â  Â  Â  Â  Â  Â  page-break-inside: avoid;Â 

Â  Â  Â  Â  Â  Â  margin-bottom: 20px;

Â  Â  Â  Â  Â  Â  table-layout: fixed;

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  #vocab-test-container th, #vocab-test-container td {Â 

Â  Â  Â  Â  Â  Â  border: 1px solid #000;Â 

Â  Â  Â  Â  Â  Â  padding: 5px 8px;Â 

Â  Â  Â  Â  Â  Â  line-height: 1.2;Â 

Â  Â  Â  Â  }



Â  Â  Â  Â  /* Ensure column widths are maintained in print */

Â  Â  Â  Â  #vocab-test-container th:first-child,

Â  Â  Â  Â  #vocab-test-container td.num-cell {

Â  Â  Â  Â  Â  Â  width: 50px; /* slightly smaller for print */

Â  Â  Â  Â  }

Â  Â  Â  Â  #vocab-test-container th:nth-child(2),

Â  Â  Â  Â  #vocab-test-container td:nth-child(2),

Â  Â  Â  Â  #vocab-test-container th:nth-child(3),

Â  Â  Â  Â  #vocab-test-container td:nth-child(3) {

Â  Â  Â  Â  Â  Â  width: calc(50% - 25px); /* Adjusted for the 50px number column */

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  /* Ensure answers are hidden for the blank quiz printout */

Â  Â  Â  Â  .answer-cell span {Â 

Â  Â  Â  Â  Â  Â  visibility: hidden !important;Â 

Â  Â  Â  Â  }

Â  Â  }

Â  </style>

</head>

<body>

<div class="container">

Â  <div id="main-menu">

Â  Â  <h1>Language Practice Hub</h1>

Â  Â  <p>Please choose an activity</p>

Â  Â  <div class="menu-buttons">

Â  Â  Â  <button id="reading-btn" class="menu-button">Reading Practice</button>

Â  Â  Â  <button id="listening-btn" class="menu-button">Listening Practice</button>

Â  Â  Â  <button id="vocab-btn" class="menu-button">Vocabulary Test</button>

Â  Â  </div>

Â  </div>



Â  <div id="practice-section" class="hide">

Â  Â  <h1 id="practice-title">Practice Section</h1>

Â  Â  <input type="hidden" id="current-practice-type" value="">

Â  Â  <div class="practice-controls">

Â  Â  Â  <div class="practice-control-group">

Â  Â  Â  Â  <label for="topic-select">Choose a Theme:</label>

Â  Â  Â  Â  <select id="topic-select"><option>Loading Themes...</option></select>

Â  Â  Â  </div>

Â  Â  Â  <div class="practice-control-group">

Â  Â  Â  Â  <label for="question-select">Choose a Question:</label>

Â  Â  Â  Â  <select id="question-select"><option>Select a Theme first...</option></select>

Â  Â  Â  </div>

Â  Â  Â  <button id="generate-practice-btn" class="btn-primary">Load Question</button>

Â  Â  Â  <button id="fullscreen-btn" class="btn-primary hide">ğŸ”ˆ Open Full Screen</button>

Â  Â  Â  <button class="btn-primary back-btn">Back to Main Menu</button>

Â  Â  </div>

Â  Â  <div id="question-display">

Â  Â  Â  <h2>Your question will appear here</h2>

Â  Â  Â  <p>Select a theme and question, then click "Load Question".</p>

Â  Â  </div>

Â  </div>



Â  <div id="vocab-section" class="hide">

Â  Â  <div class="vocab-main-wrapper">

Â  Â  Â  <div class="vocab-test-panel">

Â  Â  Â  Â  <div id="vocab-test-container" class="hide">

Â  Â  Â  Â  Â  <table>

Â  Â  Â  Â  Â  Â  <thead><tr><th>No.</th><th>Target Language</th><th>English</th></tr></thead>

Â  Â  Â  Â  Â  Â  <tbody id="vocab-test-body"></tbody>

Â  Â  Â  Â  Â  </table>

Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="vocab-print-area" class="hide"></div>

Â  Â  Â  </div>

Â  Â  Â  <div class="vocab-controls-panel" id="vocab-controls-panel">

Â  Â  Â  Â  <h1>Vocabulary Test</h1>

Â  Â  Â  Â  <div id="vocab-setup-controls" class="vocab-control-group">

Â  Â  Â  Â  Â  <label for="vocab-class-select">1. Choose Class:</label>

Â  Â  Â  Â  Â  <select id="vocab-class-select"></select>

Â  Â  Â  Â  Â  <label for="vocab-theme-select">2. Choose Theme:</label><select id="vocab-theme-select"></select>

Â  Â  Â  Â  Â  <label for="vocab-set-select">3. Choose Set:</label><select id="vocab-set-select"></select>

Â  Â  Â  Â  Â  <label for="vocab-set-select-2">4. 2nd set (Optional):</label><select id="vocab-set-select-2"></select>

Â  Â  Â  Â  Â  <button id="vocab-generate-btn" class="btn-primary">Generate List</button>

Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="vocab-test-controls" class="vocab-control-group hide">

Â  Â  Â  Â  Â  <button id="vocab-reveal-btn" class="btn-primary">Reveal Answers</button>

Â  Â  Â  Â  Â  <button id="vocab-print-btn" class="btn-primary">ğŸ–¨ï¸ Print Test</button>

Â  Â  Â  Â  </div>

Â  Â  Â  Â  <button class="btn-primary back-btn">Back to Main Menu</button>

Â  Â  Â  </div>

Â  Â  </div>

Â  </div>

</div>



<script>

// --- URLs and Global Variables ---

const practiceSheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRvNFlHDx-4cZbDzwKy5Yb_DKeSxS2wSXxyX1Ua6pGcf27yFjmqOPz9jQ_rzoV3-zoZI9lw4EIfmdXH/pub?output=csv";

// Map of all possible vocab sheets

const vocabSheetUrls = {

Â  Â  'GCSE French': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSCNeq329ih6SxLZ2TowPzpk61gJLFy-UAVAb8ivBs9DNEOdmtRQ29bWh__n53MdE-C8hs_XOV3iIkT/pub?output=csv',

Â  Â  'GCSE German': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTlddh1-sO5-s5CPJt_a1H1ltX9orRCFvosUPVBJIqjxXc0nB3c4-f19sUNF5s6lIof7TnBIevleWJA/pub?output=csv',

Â  Â  'Y9 German': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS2uwRf4d6BaS3Pr8s5Kh6l5qcueQdIypB4rB_gQVO1WNNC21wfcAALqUVflppBR5TaCFgBLFI8yCpF/pub?output=csv',

Â  Â  'Y9 French': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRnDLxwYIiKui39_UjS66eQtrFttct-nEpnEcD06p15Bm9iNpxdFihDfj6BxggMLLukIyJ72SeF_EEM/pub?output=csv',

Â  Â  'AS French': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRrT8UxOP9RIX0Udy7Q12-D2HJJVp8jfpd8lnbGO9vlHsXnWgtVeJlTXarZlROdR7cvc-Wug2ukblC8/pub?output=csv',

Â  Â  'A2 French': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRbdjmR3pBk7FniGAuKvlKQk_1zfuY9XlyhQtim-ABIdxEWk-8WmcUHxcDwOui7d1R0Uvk66LTr6eON/pub?output=csv'

};

let practice_allQuestions = [];

// vocab_vocabSets will now hold the data for the *currently* selected class

let vocab_vocabSets = {};



// --- DOM Element References ---

const mainMenu = document.getElementById('main-menu');

const practiceSection = document.getElementById('practice-section');

const vocabSection = document.getElementById('vocab-section');

const readingBtn = document.getElementById('reading-btn');

const listeningBtn = document.getElementById('listening-btn');

const vocabBtn = document.getElementById('vocab-btn');

const currentPracticeTypeInput = document.getElementById('current-practice-type');



const practice_topicSelect = document.getElementById('topic-select'); // Theme Selector

const practice_questionSelect = document.getElementById('question-select'); // Question Selector

const practice_generateBtn = document.getElementById('generate-practice-btn');



const practice_questionDisplay = document.getElementById('question-display');

const fullscreenBtn = document.getElementById('fullscreen-btn');

// NEW CLASS SELECTOR REFERENCE

const vocab_classSelect = document.getElementById('vocab-class-select');

const vocab_themeSelect = document.getElementById('vocab-theme-select');

const vocab_setSelect = document.getElementById('vocab-set-select');

const vocab_setSelect2 = document.getElementById('vocab-set-select-2');

const vocab_generateBtn = document.getElementById('vocab-generate-btn');

const vocab_testContainer = document.getElementById('vocab-test-container');

const vocab_testBody = document.getElementById('vocab-test-body');

const vocab_testControls = document.getElementById('vocab-test-controls');

const vocab_revealBtn = document.getElementById('vocab-reveal-btn');

const vocab_printArea = document.getElementById('vocab-print-area');



// --- Navigation ---

readingBtn.addEventListener('click', () => showPractice('Reading'));

listeningBtn.addEventListener('click', () => showPractice('Listening'));

vocabBtn.addEventListener('click', showVocabTest);

document.querySelectorAll('.back-btn').forEach(btn => btn.addEventListener('click', showMainMenu));



function showMainMenu() {

Â  Â  mainMenu.classList.remove('hide');

Â  Â  practiceSection.classList.add('hide');

Â  Â  vocabSection.classList.add('hide');

}



function showPractice(type) {

Â  Â  mainMenu.classList.add('hide');

Â  Â  practiceSection.classList.remove('hide');

Â  Â  vocabSection.classList.add('hide');

Â  Â  document.getElementById('practice-title').textContent = `${type} Practice`;

Â  Â  currentPracticeTypeInput.value = type;

Â  Â  practice_populateTopics();

}



function showVocabTest() {

Â  Â  mainMenu.classList.add('hide');

Â  Â  practiceSection.classList.add('hide');

Â  Â  vocabSection.classList.remove('hide');

}



// --- Data Loading ---

function loadData(url, options) {

Â  Â  return new Promise((resolve, reject) => {

Â  Â  Â  Â  Papa.parse(url, {

Â  Â  Â  Â  Â  Â  ...options,

Â  Â  Â  Â  Â  Â  download: true,

Â  Â  Â  Â  Â  Â  skipEmptyLines: true,

Â  Â  Â  Â  Â  Â  complete: (results) => resolve(results.data),

Â  Â  Â  Â  Â  Â  error: (err) => reject(err),

Â  Â  Â  Â  });

Â  Â  });

}



async function loadVocabData(url) {

Â  Â  try {

Â  Â  Â  Â  // Show loading state

Â  Â  Â  Â  vocab_themeSelect.innerHTML = `<option>Loading sets...</option>`;

Â  Â  Â  Â Â 

Â  Â  Â  Â  const vocabData = await loadData(url, { header: false });



Â  Â  Â  Â  vocab_vocabSets = {};

Â  Â  Â  Â  let currentTheme = null;Â 

Â  Â  Â  Â  let currentKey = null;

Â  Â  Â  Â  let currentWords = [];



Â  Â  Â  Â  vocabData.forEach(row => {

Â  Â  Â  Â  Â  Â  if (!row || row.length < 5) return;Â 



Â  Â  Â  Â  Â  Â  // Trim all necessary fields

Â  Â  Â  Â  Â  Â  const themeInRow = row[0]?.trim();

Â  Â  Â  Â  Â  Â  const set = row[1]?.trim();

Â  Â  Â  Â  Â  Â  // Assuming word is in col 4 (index 3) and English in col 5 (index 4) based on old logic

Â  Â  Â  Â  Â  Â  const target = row[3]?.trim();

Â  Â  Â  Â  Â  Â  const english = row[4]?.trim();



Â  Â  Â  Â  Â  Â  if (themeInRow) {

Â  Â  Â  Â  Â  Â  Â  Â  // If we hit a new theme, process the previous set if it exists

Â  Â  Â  Â  Â  Â  Â  Â  if (currentKey && currentWords.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  vocab_vocabSets[currentKey] = currentWords;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  currentTheme = themeInRow;

Â  Â  Â  Â  Â  Â  Â  Â  currentKey = null; // Reset key to wait for the first set

Â  Â  Â  Â  Â  Â  Â  Â  currentWords = [];

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  if (currentTheme && set && set !== '') { // Set must be present and not empty

Â  Â  Â  Â  Â  Â  Â  Â  const newKey = `${currentTheme}.${set}`;

Â  Â  Â  Â  Â  Â  Â  Â  if (newKey !== currentKey) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentKey && currentWords.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  vocab_vocabSets[currentKey] = currentWords;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentKey = newKey;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentWords = [];

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  // Only add word if we have an active set and valid data

Â  Â  Â  Â  Â  Â  if (currentKey && target && english) {

Â  Â  Â  Â  Â  Â  Â  Â  currentWords.push({ target, english });

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  });



Â  Â  Â  Â  // Add the very last set processed

Â  Â  Â  Â  if (currentKey && currentWords.length > 0) {

Â  Â  Â  Â  Â  Â  vocab_vocabSets[currentKey] = currentWords;

Â  Â  Â  Â  }



Â  Â  Â  Â  vocab_initializeSelectors();

Â  Â  Â  Â Â 

Â  Â  } catch (error) {

Â  Â  Â  Â  console.error("Failed to load vocabulary data:", error);

Â  Â  Â  Â  vocab_vocabSets = {}; // Clear previous data on error

Â  Â  Â  Â  vocab_themeSelect.innerHTML = `<option>Error Loading Data</option>`;

Â  Â  Â  Â  vocab_setSelect.innerHTML = '';

Â  Â  Â  Â  vocab_setSelect2.innerHTML = '';

Â  Â  }

}



async function initializeApp() {

Â  Â  readingBtn.disabled = true;

Â  Â  listeningBtn.disabled = true;

Â  Â  vocabBtn.disabled = true;

Â  Â  readingBtn.textContent = 'Loading...';



Â  Â  // Populate class selector first

Â  Â  const classNames = Object.keys(vocabSheetUrls);

Â  Â  vocab_classSelect.innerHTML = '<option value="">-- Select Class --</option>';

Â  Â  classNames.forEach(name => {

Â  Â  Â  Â  const opt = document.createElement('option');

Â  Â  Â  Â  opt.value = name;

Â  Â  Â  Â  opt.textContent = name;

Â  Â  Â  Â  vocab_classSelect.appendChild(opt);

Â  Â  });

Â  Â Â 

Â  Â  let initialUrl = null;

Â  Â  // Set default selection and get URL

Â  Â  if (classNames.length > 0) {

Â  Â  Â  Â  vocab_classSelect.value = classNames[0];

Â  Â  Â  Â  initialUrl = vocabSheetUrls[classNames[0]];

Â  Â  }



Â  Â  try {

Â  Â  Â  Â  // Load practice data (which is a single sheet)

Â  Â  Â  Â  const practiceData = await loadData(practiceSheetUrl, { header: true });



Â  Â  Â  Â  // Renaming columns based on new structure: A=Skill, B=Theme, C=Question, D=Content

Â  Â  Â  Â  practice_allQuestions = practiceData.map(q => ({

Â  Â  Â  Â  Â  Â  Skill: q.Skill,

Â  Â  Â  Â  Â  Â  Theme: q.Theme,

Â  Â  Â  Â  Â  Â  Question: q.Question,

Â  Â  Â  Â  Â  Â  Content: q.Content

Â  Â  Â  Â  })).filter(q => q.Skill && q.Theme && q.Content);



Â  Â  Â  Â  // Load the initial vocab data (if a class was selected)

Â  Â  Â  Â  if (initialUrl) {

Â  Â  Â  Â  Â  Â  await loadVocabData(initialUrl);

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  readingBtn.disabled = false;

Â  Â  Â  Â  listeningBtn.disabled = false;

Â  Â  Â  Â  vocabBtn.disabled = false;

Â  Â  Â  Â  readingBtn.textContent = 'Reading Practice';



Â  Â  } catch (error) {

Â  Â  Â  Â  console.error("Failed to load spreadsheet data:", error);

Â  Â  Â  Â  document.querySelector('.container').innerHTML = '<h1>Error</h1><p>Could not load data from the spreadsheets. Please check the URLs and make sure the sheets are published correctly.</p>';

Â  Â  }

}



// --- Practice Section Logic ---

practice_topicSelect.addEventListener('change', practice_populateQuestions);

practice_generateBtn.addEventListener('click', practice_generateQuestion);



function practice_populateTopics() {

Â  Â  const selectedType = currentPracticeTypeInput.value;

Â  Â  // Use column B: Theme

Â  Â  const themes = [...new Set(practice_allQuestions.filter(q => q.Skill === selectedType).map(q => q.Theme))];Â 

Â  Â Â 

Â  Â  practice_topicSelect.innerHTML = '<option value="">-- Select Theme --</option>';Â 

Â  Â Â 

Â  Â  if (themes.length === 0) {

Â  Â  Â  Â  practice_topicSelect.innerHTML = `<option>No Themes Available</option>`;

Â  Â  Â  Â  practice_questionSelect.innerHTML = `<option>Select a Theme first...</option>`;

Â  Â  Â  Â  return;

Â  Â  }

Â  Â  themes.sort().forEach(theme => {

Â  Â  Â  Â  if (theme) {Â 

Â  Â  Â  Â  Â  Â  const opt = document.createElement('option');

Â  Â  Â  Â  Â  Â  opt.value = theme;

Â  Â  Â  Â  Â  Â  opt.textContent = theme;

Â  Â  Â  Â  Â  Â  practice_topicSelect.appendChild(opt);

Â  Â  Â  Â  }

Â  Â  });



Â  Â  // Automatically call the next step or reset the questions dropdown

Â  Â  practice_populateQuestions();

}





function practice_populateQuestions() {

Â  Â  const selectedTheme = practice_topicSelect.value;

Â  Â  const selectedType = currentPracticeTypeInput.value;

Â  Â  practice_questionSelect.innerHTML = '';

Â  Â Â 

Â  Â  if (!selectedTheme) {

Â  Â  Â  Â  practice_questionSelect.innerHTML = `<option>Select a Theme first...</option>`;

Â  Â  Â  Â  return;

Â  Â  }



Â  Â  // Filter questions based on both Skill (Col A) and Theme (Col B)

Â  Â  const questions = practice_allQuestions.filter(q =>Â 

Â  Â  Â  Â  q.Skill === selectedType && q.Theme === selectedTheme

Â  Â  );



Â  Â  if (questions.length === 0) {

Â  Â  Â  Â  practice_questionSelect.innerHTML = `<option>No Questions Available</option>`;

Â  Â  Â  Â  return;

Â  Â  }

Â  Â Â 

Â  Â  questions.forEach((q, index) => {

Â  Â  Â  Â  const opt = document.createElement('option');

Â  Â  Â  Â  // Store the full URL (Content - Col D) as the value

Â  Â  Â  Â  opt.value = q.Content;Â 

Â  Â  Â  Â  // Display the question (Col C)

Â  Â  Â  Â  opt.textContent = q.Question;Â 

Â  Â  Â  Â  practice_questionSelect.appendChild(opt);

Â  Â  });

}



function practice_generateQuestion() {

Â  Â  const selectedContentUrl = practice_questionSelect.value;

Â  Â Â 

Â  Â  if (!selectedContentUrl) {

Â  Â  Â  Â  practice_questionDisplay.innerHTML = `<h2>Please select a Question.</h2><p>Please select a Theme first, then select a Question from the list.</p>`;

Â  Â  Â  Â  return;

Â  Â  }



Â  Â  // Find the specific question object based on the Content URL

Â  Â  const q = practice_allQuestions.find(item => item.Content === selectedContentUrl);

Â  Â Â 

Â  Â  if (!q) {

Â  Â  Â  Â  practice_questionDisplay.innerHTML = `<p>Error: Content not found.</p>`;

Â  Â  Â  Â  return;

Â  Â  }

Â  Â Â 

Â  Â  fullscreenBtn.classList.add('hide');

Â  Â  fullscreenBtn.onclick = null;



Â  Â  let contentHtml = q.Content;

Â  Â  const originalUrl = q.Content;



Â  Â  // Slide/Embed Logic

Â  Â  if (originalUrl && originalUrl.includes('google.com/presentation')) {

Â  Â  Â  Â  const fileIdMatch = originalUrl.match(/\/d\/([a-zA-Z0-9_-]+)/);

Â  Â  Â  Â Â 

Â  Â  Â  Â  // Match either ?slide= or #slide=

Â  Â  Â  Â  const slideIdMatch = originalUrl.match(/[?#]slide=id\.([a-zA-Z0-9_.-]+)/);



Â  Â  Â  Â  if (fileIdMatch) {

Â  Â  Â  Â  Â  Â  const fileId = fileIdMatch[1];

Â  Â  Â  Â  Â  Â  let embedUrl;

Â  Â  Â  Â  Â  Â  let presentUrl;



Â  Â  Â  Â  Â  Â  if (slideIdMatch) {

Â  Â  Â  Â  Â  Â  Â  Â  // Specific slide ID found

Â  Â  Â  Â  Â  Â  Â  Â  const slideId = `id.${slideIdMatch[1]}`;

Â  Â  Â  Â  Â  Â  Â  Â  embedUrl = `https://docs.google.com/presentation/d/${fileId}/embed?start=false&loop=false&slide=${slideId}`;

Â  Â  Â  Â  Â  Â  Â  Â  // Presentation link format must use a hash for navigation

Â  Â  Â  Â  Â  Â  Â  Â  presentUrl = `https://docs.google.com/presentation/d/${fileId}/present#slide=${slideId}`;

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  // No slide ID, link to the start

Â  Â  Â  Â  Â  Â  Â  Â  embedUrl = `https://docs.google.com/presentation/d/${fileId}/embed?start=false&loop=false`;

Â  Â  Â  Â  Â  Â  Â  Â  presentUrl = `https://docs.google.com/presentation/d/${fileId}/present`;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  contentHtml = `<iframe src="${embedUrl}" allowfullscreen></iframe>`;

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  fullscreenBtn.classList.remove('hide');

Â  Â  Â  Â  Â  Â  fullscreenBtn.onclick = () => { window.open(presentUrl, '_blank'); };

Â  Â  Â  Â  }

Â  Â  }

Â  Â Â 

Â  Â  practice_questionDisplay.innerHTML = `<h2>${q.Question}</h2>${contentHtml}`;

}



// --- Vocabulary Section Logic ---

const vocab_themeMap = {

Â  Â  '1': '1-Personal world',

Â  Â  '2': '2-Lifestyle',

Â  Â  '3': '3-Neighbourhood',

Â  Â  '4': '4-Media & Tech',

Â  Â  '5': '5-Study & future',

Â  Â  '6': '6-Travel and Tourism'

};



// New event listener for class change

vocab_classSelect.addEventListener('change', async () => {

Â  Â  const selectedClass = vocab_classSelect.value;

Â  Â  const url = vocabSheetUrls[selectedClass];

Â  Â  if (url) {

Â  Â  Â  Â  // Clear old list and show loading text

Â  Â  Â  Â  vocab_themeSelect.innerHTML = `<option>Loading sets for ${selectedClass}...</option>`;

Â  Â  Â  Â  vocab_setSelect.innerHTML = '';

Â  Â  Â  Â  vocab_setSelect2.innerHTML = '';

Â  Â  Â  Â  vocab_testContainer.classList.add('hide');

Â  Â  Â  Â  vocab_testControls.classList.add('hide');

Â  Â  Â  Â  // Load new data

Â  Â  Â  Â  await loadVocabData(url);

Â  Â  } else {

Â  Â  Â  Â  // Clear selectors if no class is selected or URL is missing

Â  Â  Â  Â  vocab_vocabSets = {};

Â  Â  Â  Â  vocab_initializeSelectors();

Â  Â  }

});



function vocab_initializeSelectors() {

Â  Â  // Clear previous selections

Â  Â  vocab_themeSelect.innerHTML = '<option value="">-- Select Theme --</option>';

Â  Â  vocab_setSelect.innerHTML = '';

Â  Â  vocab_setSelect2.innerHTML = '';

Â  Â  vocab_testContainer.classList.add('hide');

Â  Â  vocab_testControls.classList.add('hide');

Â  Â Â 

Â  Â  // Get unique themes from the currently loaded data

Â  Â  const themes = [...new Set(Object.keys(vocab_vocabSets).map(k => k.split('.')[0]))];

Â  Â Â 

Â  Â  themes.sort().forEach(theme => {

Â  Â  Â  Â  const opt = document.createElement('option');

Â  Â  Â  Â  opt.value = theme;

Â  Â  Â  Â  opt.textContent = vocab_themeMap[theme] || `Theme ${theme}`;

Â  Â  Â  Â  vocab_themeSelect.appendChild(opt);

Â  Â  });

Â  Â Â 

Â  Â  // Manually trigger the set update, which handles initial 'None' for set 2

Â  Â  vocab_updateSetDropdown();

}



function vocab_updateSetDropdown() {

Â  Â  const theme = vocab_themeSelect.value;

Â  Â  vocab_setSelect.innerHTML = '';

Â  Â  vocab_setSelect2.innerHTML = '';

Â  Â Â 

Â  Â  const none = document.createElement('option');

Â  Â  none.value = '';

Â  Â  none.textContent = '-- None --';

Â  Â  vocab_setSelect2.appendChild(none);



Â  Â  if (!theme) return;



Â  Â  // Filter sets based on the selected theme in the current vocab_vocabSets

Â  Â  const sets = Object.keys(vocab_vocabSets).filter(k => k.startsWith(theme + '.'));

Â  Â  sets.sort().forEach(setName => {

Â  Â  Â  Â  const opt1 = document.createElement('option');

Â  Â  Â  Â  opt1.value = setName;

Â  Â  Â  Â Â 

Â  Â  Â  Â  const topicName = setName.substring(setName.indexOf('.') + 1);

Â  Â  Â  Â Â 

Â  Â  Â  Â  opt1.textContent = `${topicName} (${vocab_vocabSets[setName].length} words)`;

Â  Â  Â  Â  vocab_setSelect.appendChild(opt1);

Â  Â  Â  Â  vocab_setSelect2.appendChild(opt1.cloneNode(true));

Â  Â  });

}



vocab_themeSelect.addEventListener('change', vocab_updateSetDropdown);

vocab_generateBtn.addEventListener('click', vocab_generateTest);

vocab_revealBtn.addEventListener('click', vocab_revealAnswers);

document.getElementById('vocab-print-btn').addEventListener('click', vocab_generatePrintVersion);



function vocab_generateTest() {

Â  Â  const set1 = vocab_setSelect.value;

Â  Â  if (!set1) {

Â  Â  Â  Â  alert("Please select a Theme and at least one Set.");

Â  Â  Â  Â  return;

Â  Â  }



Â  Â  let combined = [...vocab_vocabSets[set1]];

Â  Â  const set2 = vocab_setSelect2.value;

Â  Â  if (set2 && set2 !== set1) { // Prevent adding the same set twice

Â  Â  Â  Â  combined = combined.concat(vocab_vocabSets[set2]);

Â  Â  }

Â  Â Â 

Â  Â  // De-duplicate

Â  Â  let uniqueCombined = Array.from(new Map(combined.map(item => [item.target, item])).values());

Â  Â  if (uniqueCombined.length === 0) return;



Â  Â  // Shuffle the entire unique list once

Â  Â  const shuffled = uniqueCombined.sort(() => 0.5 - Math.random());

Â  Â Â 

Â  Â  vocab_testBody.innerHTML = '';



Â  Â  // Take the first 5 (or fewer) for Target -> English questions (Column 2 is question, Column 3 is answer)

Â  Â  const targetFirstQuestions = shuffled.slice(0, 5);

Â  Â  targetFirstQuestions.forEach((item, i) => {

Â  Â  Â  Â  const row = vocab_testBody.insertRow();

Â  Â  Â  Â  row.innerHTML = `<td class="num-cell">${i + 1}</td><td>${item.target}</td><td class="answer-cell"><span>${item.english}</span></td>`;

Â  Â  });



Â  Â  // Take the next 5 (or fewer) for English -> Target questions (Column 3 is question, Column 2 is answer)

Â  Â  const englishFirstQuestions = shuffled.slice(5, 10);

Â  Â  englishFirstQuestions.forEach((item, i) => {

Â  Â  Â  Â  const row = vocab_testBody.insertRow();

Â  Â  Â  Â  const rowNumber = targetFirstQuestions.length + i + 1; // Continue numbering

Â  Â  Â  Â  // Swap the columns: English is displayed, Target is hidden in the answer cell

Â  Â  Â  Â  row.innerHTML = `<td class="num-cell">${rowNumber}</td><td class="answer-cell"><span>${item.target}</span></td><td>${item.english}</td>`;

Â  Â  });
Â  Â  vocab_testContainer.classList.remove('hide');
Â  Â  vocab_testControls.classList.remove('hide');
Â  Â  vocab_printArea.classList.add('hide');
Â  Â  // Ensure answers start hidden
Â  Â  document.querySelectorAll('#vocab-test-container .answer-cell span').forEach(s => s.classList.remove('visible'));
}
function vocab_revealAnswers() {
Â  Â  document.querySelectorAll('#vocab-test-container .answer-cell span').forEach(s => s.classList.toggle('visible'));
}
function vocab_generatePrintVersion() {

Â  Â  // Rely entirely on the @media print CSS block to control what is visible.
Â  Â  vocab_printArea.classList.add('hide');Â 
Â  Â  document.title = "Vocabulary Test - Print Version";
Â  Â  window.print();
Â  Â  document.title = "Language Practice Hub";
}
// --- Start the App ---

initializeApp();



</script>

</body>

</html>
